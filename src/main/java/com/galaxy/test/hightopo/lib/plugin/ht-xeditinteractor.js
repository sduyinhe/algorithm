!function(H,g,u){"use strict";var E="ht",O=H[E],j=O.Default,c=O.graph,J=j.getInternal(),N=J.ui(),v=N.NodeUI.prototype,b=N.ShapeUI.prototype,f=c.GraphView,q=f.prototype,o=N.EdgeUI.prototype,S=O.Node,U=O.Shape,L=O.Edge,B=O.Group,m=j.isTouchable,Y=j.preventDefault,T=H.setTimeout,h=j.grow,F=j.isDragging,P=j.getDistance,G=null,l=O.List,t="undefined"!=typeof Float32Array?Float32Array:Array,y=Math,I=y.PI,p="Crossing",W="No Crossing",D=I/2,w=2*I,_=y.atan2,n=y.sqrt,a=y.pow,Z=y.sin,r=y.cos,R=y.min,s=y.max,d=y.abs,x=y.ceil,K=y.round,V=j.unionPoint,A=j.unionRect,e=j.containsPoint,M=j.clone,k="rgb(52, 152, 219)",i="red",C={northwest:0,north:1,northeast:2,west:7,east:3,southwest:6,south:5,southeast:4},X={width:400,height:100,comps:[{type:"shape",points:{func:function(){for(var E=[10,8,162,36,314,37,269,2,398,49,268,98,314,58,161,60,9,91,103,49,10,8],A=0;A<E.length;A++){var p=E[A];p=0===A%2?p/400*X.width:p/100*X.height,E[A]=p}return X.width>120&&(E[4]=X.width-26,E[6]=X.width-40,E[10]=X.width-40,E[12]=X.width-26,E[18]=33),E}},segments:[1,3,2,2,2,2,3,2,2],background:"white",gradient:"linear.east",gradientColor:"red"}]},Q={width:300,height:300,comps:[{type:"circle",rect:[20,0,120,120],background:k,rotation:.61},{type:"circle",rect:[200,120,70,70],background:k,rotation:.61},{type:"circle",rect:[200,220,70,70],background:k,rotation:.61},{type:"shape",points:[80,60,80,155,200,155],borderWidth:20,borderColor:k},{type:"shape",points:[80,60,80,255,200,255],borderWidth:20,borderColor:k}]},z={width:300,height:300,comps:[{type:"shape",points:[114,239,115,106,112,73,149,73,149,73,175,73,177,105,179,261,178,302,147,307,98,308,83,307,72,276,73,260,72,81,74,29,115,21,191,21,221,22,224,53,223,238],segments:[1,2,3,2,3,2,3,2,4,2,3,2,3,2],borderWidth:20,borderColor:i,rotation:.61}]},$={width:300,height:300,comps:[{type:"circle",rect:[210,0,90,90],background:k},{type:"circle",rect:[0,210,90,90],background:k},{type:"shape",points:[255,45,45,255],borderWidth:20,borderColor:k}]},xn={width:300,height:300,comps:[{type:"shape",points:[20,20,280,280],borderWidth:30,borderColor:i},{type:"shape",points:[280,20,20,280],borderWidth:30,borderColor:i}]},jj={width:300,height:300,comps:[{type:"shape",points:[270,30,30,150,270,270],borderWidth:40,borderColor:k}]},Nm={width:300,height:300,comps:[{type:"shape",points:[30,30,270,150,30,270],borderWidth:40,borderColor:i}]},Re={width:300,height:300,comps:[{type:"rect",rect:[125.58,52.76,40,231.96],background:"rgb(0,0,0)",borderWidth:1,borderColor:"#000"},{type:"rect",rect:[27.87,61.06,150,30],background:"rgb(0,0,0)",borderWidth:1,borderColor:"#000",rotation:5.5},{type:"rect",rect:[113.36,61,150,30],background:"rgb(0,0,0)",borderWidth:1,borderColor:"#000",rotation:.79}]},tk={width:300,height:300,author:"",note:"",comps:[{type:"rect",rect:[135.15,38.76,28.63,82.84],background:"rgb(0,0,0)",borderWidth:1,borderColor:"#000"},{type:"triangle",rect:[94.69,2.35,110,44.77],background:"rgb(0,0,0)",borderWidth:1,borderColor:"#000"},{type:"rect",rect:[31.71,115.72,240,15],background:"rgb(0,0,0)",borderWidth:1,borderColor:"#000"},{type:"rect",rect:[31.71,167.62,240,15],background:"rgb(0,0,0)",borderWidth:1,borderColor:"#000"},{type:"rect",rect:[135.15,177.33,28.63,82.84],background:"rgb(0,0,0)",borderWidth:1,borderColor:"#000"},{type:"triangle",rect:[94.69,251.39,110,44.77],background:"rgb(0,0,0)",borderWidth:1,borderColor:"#000",rotation:3.14}]},Gg=function(l){var a=l.touches[0];return a?a:l.changedTouches[0]},lk=function(T,z,X,Z){return _(Z-z,X-T)},Rc=function(k,A){return{x:k.x*A,y:k.y*A}},yq=function(J,e){var g,U,y,u,G=J._layers,D=J.sm().getSelection()._as,A=D.length;if(G)for(g=0;g<G.length;g++){u=G[g];for(var j=0;A>j;j++)if(U=D[j],U._layer===u&&(y=e(U),y===!1))return}else for(g=0;A>g;g++)if(U=D[g],y=e(U),y===!1)return},Qb=function(V,r,Y){var t,C,a,w,i,R=this,j=r,_=R.gv;if(V instanceof U){a=V.getSegments();var o=_.getDataUI(V);i=o._55O.$15l,a||(a=gn(i)),V.isClosePath()&&a.indexOf(5)<0&&(a=new l(a._as),a.add(5)),t=rb(V,o,j),C=i[t]}else{var B=_.getDataUI(V);i=Tj(B,V.s("edge.points")),a=V.s("edge.segments"),a||(a=gn(i)),i=i._as,t=rb(V,B,j),C=i[t]}if(a&&(w=a.get(j)),2===w||1===w||5===w){var M=i[t+1];5===w&&(M=i[0]);var g=ic(C,Y,M);return g}return Y},vr=function(e,D){var S,$,K,O,B=e._layers,L=e.sm().getSelection()._as,N=L.length;if(B)for(S=B.length-1;S>=0;S--){O=B[S];for(var J=N-1;J>=0;J--)if($=L[J],$._layer===O&&(K=D($),K===!1))return}else for(S=N-1;S>=0;S--)if($=L[S],K=D($),K===!1)return},Ni=function(k,K,t,h){var G=K/2,J=t/2,A=$d(k,-G,-J,h),Z=$d(k,G,-J,h),$=$d(k,-G,J,h),W=$d(k,G,J,h),n=$d(k,0,-J,h),e=$d(k,G,0,h),M=$d(k,0,J,h),X=$d(k,-G,0,h);return[A,Z,$,W,n,e,M,X]},ic=function(c,W,T){var w={x:W.x-c.x,y:W.y-c.y},A={x:T.x-c.x,y:T.y-c.y},m=n(a(T.x-c.x,2)+a(T.y-c.y,2)),b={x:A.x/m,y:A.y/m},E=w.x*b.x+w.y*b.y,t={x:b.x*E,y:b.y*E};return{x:c.x+t.x,y:c.y+t.y}},$d=function(p,Q,d,O){var n=r(O)*Q-Z(O)*d,B=Z(O)*Q+r(O)*d;return p?{x:p.x+n,y:p.y+B}:{x:n,y:B}},hk=function(L,U){return U>2*L?L:U/2},sg=function(g,E,B,V){var w=P(g,E);return B=V?R(B,w):hk(B,w),w?B/=w:B=0,{x:g.x+(E.x-g.x)*B,y:g.y+(E.y-g.y)*B}},ls=function(j,T,u,C,h){return T?(u=J.getPosition(u,J.getNodeRect(j,T)),u.x+=C||0,u.y+=h||0,u):G},fh=function(H,k){var j,e,b=H.gv,R=H._data,v=R._40I,Q=R._41I,o=R.s("edge.offset"),$=R.s("edge.source.position"),I=R.s("edge.target.position"),G=R.s("edge.source.offset.x"),J=R.s("edge.source.offset.y"),q=R.s("edge.target.offset.x"),h=R.s("edge.target.offset.y");if(k?(j=ls(b,v,$,G,J),e=ls(b,Q,I,q,h)):(j=ls(b,v,$),e=ls(b,Q,I)),"points"===R.s("edge.type")&&o&&!R.s("edge.center")&&j){var E=R.s("edge.points")||new l,D=E.size(),z=sg(j,D?E.get(0):e,o,D),X=sg(e,D?E.get(D-1):j,o,D);j=z,e=X}return[j,e]},Tj=function(B,n,u){var r=B._78o,h=B._data,I=h.s("edge.type"),x=[r._69o,r._70o];return"points"===I?u&&(x=fh(B)):x=r.center?I?u?fh(B):fh(B,!0):u?fh(B):[r.c1,r.c2]:u?fh(B):fh(B,!0),n=new l(n?n._as:G),n.add(x[0],0),n.add(x[1]),n},fd=function(_){return _=new l(_._as),_.removeAt(0),_.removeAt(_.size()-1),_},gn=function(N){N._as||(N=new l(N));var Q=new l;Q.add(1);for(var h=1;h<N.size();h++)Q.add(2);return Q},Wl=function(_,d){return{x:(_.x+d.x)/2,y:(_.y+d.y)/2}},ws=function(H,C){return{x:H.x+1*(C.x-H.x)/4,y:H.y+1*(C.y-H.y)/4}},ce=function(e,w){return{x:e.x+3*(w.x-e.x)/4,y:e.y+3*(w.y-e.y)/4}},fp=function(v,P,K,i){var w=P.x+P.width/2,O=P.y+P.height/2,G=n(w*w+O*O),U=_(O,w)+K;return{x:i.x+G*r(U),y:i.y+G*Z(U)}},Vn=q.validateImpl,Dg=q.isRectEditable,Md=q.isPointEditable,Oe=q._42,Wg=b._79o,Xe=o._79o,Lm=b._48O,Sm=b._47O,oi=v._48O,ed=v._80o,Ae=b._80o,Tk=v._2o,zd=v._47O,Rj=o._47O,Eg=q.isEditable,Ap=["northwest","north","northeast","east","southeast","south","southwest","west"],mq=function(r,Z,A,z,f,O,T,N,k,C){var w=r.x,Q=r.y,H=r.width,I=r.height,j={x:w+H/2,y:Q+I/2};z=z||0,Z=$d(j,Z.x-j.x,Z.y-j.y,-z),T&&!N&&(Z.x+=k,Z.y+=C);var o=.01;if("northwest"===A?(Z.x+f>w+H-o&&(Z.x=w+H-f-o),Z.y+f>Q+I-o&&(Z.y=Q+I-f-o),r=V(Z,{x:w+H,y:Q+I})):"north"===A?(Z.y+f>Q+I-o&&(Z.y=Q+I-f-o),r=V({x:w,y:Z.y},{x:w+H,y:Q+I})):"northeast"===A?(Z.x<w+f+o&&(Z.x=w+f+o),Z.y+f>Q+I-o&&(Z.y=Q+I-f-o),r=V({x:w,y:Z.y},{x:Z.x,y:Q+I})):"west"===A?(Z.x+f>w+H-o&&(Z.x=w+H-f-o),r=V({x:Z.x,y:Q},{x:w+H,y:Q+I})):"east"===A?(Z.x<w+f+o&&(Z.x=w+f+o),r=V({x:w,y:Q},{x:Z.x,y:Q+I})):"southwest"===A?(Z.x+f>w+H-o&&(Z.x=w+H-f-o),Z.y<Q+f+o&&(Z.y=Q+f+o),r=V({x:Z.x,y:Q},{x:w+H,y:Z.y})):"south"===A?(Z.y<Q+f+o&&(Z.y=Q+f+o),r=V({x:w,y:Q},{x:w+H,y:Z.y})):"southeast"===A&&(Z.x<w+f+o&&(Z.x=w+f+o),Z.y<Q+f+o&&(Z.y=Q+f+o),r=V({x:w,y:Q},Z)),"keepRatio"===O&&(!T&&N||T&&!N)&&("northeast"===A||"southeast"===A||"northwest"===A||"southwest"===A)){var h=r.width,_=r.height,y=h/H,n=_/I,W=R(y,n);r.width=H*W,r.height=I*W,"northeast"===A?r.y=Q+(I-r.height):"northwest"===A?(r.y=Q+(I-r.height),r.x=w+(H-r.width)):"southwest"===A&&(r.x=w+(H-r.width))}r.x-=j.x,r.y-=j.y;var L=fp(G,r,z,j);return r.x=L.x-r.width/2,r.y=L.y-r.height/2,r},As=function(t,I,b,D){var E=t.getRotation(),T=I,w=T.x,d=T.y,u=T.width,H=T.height,g={x:w+T.width/2,y:d+T.height/2};D=$d(g,D.x-g.x,D.y-g.y,-E),"northwest"===b?T=V(D,{x:w+u,y:d+H}):"north"===b?T=V({x:w,y:D.y},{x:w+u,y:d+H}):"northeast"===b?T=V({x:w,y:D.y},{x:D.x,y:d+H}):"west"===b?T=V({x:D.x,y:d},{x:w+u,y:d+H}):"east"===b?T=V({x:w,y:d},{x:D.x,y:d+H}):"southwest"===b?T=V({x:D.x,y:d},{x:w+u,y:D.y}):"south"===b?T=V({x:w,y:d},{x:w+u,y:D.y}):"southeast"===b&&(T=V({x:w,y:d},D)),t.setRect(T),T.x-=g.x,T.y-=g.y;var M=fp(t,T,E,g);t.p(M.x,M.y)},tp=function(h,Q,O,$,P,D,M,m){var N=G;D?(N=$d(G,P.x-Q.x,P.y-Q.y,-O),N.x-=M.x,N.y-=M.y):N=$d(G,P.x-Q.x,P.y-Q.y,0);var V={x:Q.x+N.x,y:Q.y+N.y};m&&(V=m(V.x,V.y)),V.e=h.getPoints().get($).e,h.setPoint($,V);var x=h.getWidth(),C=h.getHeight(),q=h.p().x-x/2,d=h.p().y-C/2;q-=Q.x,d-=Q.y;var U=fp(h,{x:q,y:d,width:x,height:C},O,Q);h.p(U.x,U.y)},rb=function(Q,F,x){var v,H;if(Q instanceof U?(v=Q.getPoints(),H=Q.getSegments()):Q instanceof L&&"points"===Q.s("edge.type")&&(v=Q.s("edge.points"),H=Q.s("edge.segments"),v=Tj(F,v)),H||(H=gn(v)),Q instanceof U&&Q.isClosePath()&&H.indexOf(5)<0&&(H=new l(H._as),H.add(5)),H)for(var C=-1,t=0;t<H.size();t++){if(t===x)return C;var y=H.get(t);1===y?C+=1:2===y?C+=1:3===y?C+=2:4===y&&(C+=3)}},Kq=function(T,j,Y){var W,K;if(T instanceof U?(W=T.getPoints(),K=T.getSegments()):T instanceof L&&"points"===T.s("edge.type")&&(W=T.s("edge.points"),K=T.s("edge.segments"),W=Tj(j,W)),K||(K=gn(W)),K)for(var g=-1,_=0;_<K.size();_++){var H=K.get(_);if(1===H?g+=1:2===H?g+=1:3===H?g+=2:4===H&&(g+=3),g===Y)return _}},Xr=function(l,H){var J=[l[0]-H[0],l[1]-H[1],l[2]-H[2]];return J},sl=function(){var r=new t(16);return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},fn=function(w,e){var d=w[0],C=w[1],L=w[2];return w[0]=e[0]*d+e[4]*C+e[8]*L+e[12],w[1]=e[1]*d+e[5]*C+e[9]*L+e[13],w[2]=e[2]*d+e[6]*C+e[10]*L+e[14],w},Fe=function(V,Y){if(Y){var l=Z(Y),X=r(Y),b=V[0],e=V[1],j=V[2],c=V[3],N=V[8],M=V[9],G=V[10],B=V[11];V[0]=b*X-N*l,V[1]=e*X-M*l,V[2]=j*X-G*l,V[3]=c*X-B*l,V[8]=b*l+N*X,V[9]=e*l+M*X,V[10]=j*l+G*X,V[11]=c*l+B*X}},Sc=function(H,v){for(var n=H.s("grid.row.count"),W=H.s("grid.column.count"),j=0;n>j;j++)for(var m=0;W>m;m++){var Z=H.getCellRect(j,m);if(e(Z,v))return{rowIndex:j,columnIndex:m,rect:Z,grid:H}}return null},le=function(g,T,l,L,f,I){var b={},v=l-g,U=L-T,K=y.sqrt(v*v+U*U),z=v/K,S=U/K,e=(-g+f)*z+(-T+I)*S;return 0>=e?(b.x=g,b.y=T):e>=K?(b.x=l,b.y=L):(b.x=g+e*z,b.y=T+e*S),v=f-b.x,U=I-b.y,b.z=y.sqrt(v*v+U*U),b},_m=function(v,$){var Y,Z,w,b,q,K,L,F,f=v.getPoints(),t=v.getSegments(),R=v.p(),e=v.getRotation();if(!t||!(t.indexOf(3)>0||t.indexOf(4)>0)){for(F=0;F<=f.size()-1;F++)if(F===f.size()-1?(q=f.get(0),b=f.get(F)):(b=f.get(F),q=f.get(F+1)),b=$d(R,b.x-R.x,b.y-R.y,e),q=$d(R,q.x-R.x,q.y-R.y,e),K=le(b.x,b.y,q.x,q.y,$.x,$.y),L=K.z,L<(v.s("shape.border.width")||10)){Z=b,w=q,Y=F;break}if(Y!=G){var E=le(Z.x,Z.y,w.x,w.y,$.x,$.y),y=P(Z,E);return{attachIndex:Y,attachOffset:y}}}},Wj=function(v){for(var B=v._data,N=B.p(),W=B.getRotation(),J=B.getPoints(),F=G,w=[],j=0;j<J.size();j++)F=J.get(j),w.push($d(N,F.x-N.x,F.y-N.y,W));v._55O.$15l=w};q._editPointSize=m?24:9,q._edgeHelpers=["parent","remove","source","target"],q._leftTopHelpers=["parent"],q._rightTopHelpers=["host"],q._leftBottomHelpers=["edge"],q._rightBottomHelpers=["remove"],Ap=Ap.concat(Ap).concat(Ap),o._79o=function(){var T=this,w=T.gv,d=w.getZoom(),X=w._editInteractor,D=Xe.call(T),x=fh(T,!0),e=x[0],R=x[1],q={x:D.x,y:D.y,width:D.width,height:D.height},K=V(e,R);if(X instanceof c.XEditInteractor){q=A(q,K);var G=T._55O,L=w.getEditPointSize()/d+2,O=0;G&&G._43O&&(O+=L/2,h(q,O))}return q},o._47O=function(l){var X=this,P=X.gv,n=P._editInteractor;n instanceof c.XEditInteractor||Rj.call(X,l)},o.rectIntersects=function(g){var Y=this,z=Y._data,i=Y.gv,P=i.getZoom(),h=Y._55O,t=i._editInteractor;if(t instanceof c.XEditInteractor&&i.isEditable(z)&&h&&h._43O&&"points"===z.s("edge.type")){var x=z.s("edge.points"),L=z.s("edge.segments");x=Tj(Y,x),L||(L=gn(x)),x=x._as;var r=!1,w=m?5:1,I=g.x+w,_=g.y+w,M={x:I,y:_};if(t._edge===z&&t._hoverSegmentIndex>=0){var C=i._editInteractor._hoverSegmentIndex,e=L.get(C),Z=rb(z,Y,C),s=G;if(Z!=G&&Z>=0){var F=x[Z],d=i.getSegmentHoverWidth()/P;if(2===e||1===e){var $=x[Z+1];s=xq(new Cq(F.x,F.y),new Cq($.x,$.y),new Cq(M.x-d,M.y-d),new Cq(M.x+2*d,M.y+2*d)),s.$62l===p&&(r=!0)}else if(3===e){var W=x[Z+1],$=x[Z+2];s=eh(new Cq(F.x,F.y),new Cq(W.x,W.y),new Cq($.x,$.y),new Cq(M.x-d,M.y-d),new Cq(M.x+2*d,M.y+2*d)),s.$62l===p&&(r=!0)}else if(4===e){var q=x[Z+1],J=x[Z+2];$=x[Z+3],s=Un(new Cq(F.x,F.y),new Cq(q.x,q.y),new Cq(J.x,J.y),new Cq($.x,$.y),new Cq(M.x-d,M.y-d),new Cq(M.x+2*d,M.y+2*d)),s.$62l===p&&(r=!0)}}}if(r)return!0}return G},b._47O=function(m){var $=this,N=$.gv,U=N._editInteractor;U instanceof c.XEditInteractor||Sm.call($,m)},b.rectIntersects=function(T){var D=this,q=D._data,_=D.gv,M=_.getZoom(),L=D._55O,n=_._editInteractor;if(n instanceof c.XEditInteractor&&_.isEditable(q)&&L&&L._43O){var f=L.$15l,g=!1,E=m?5:1,v=T.x+E,Y=T.y+E,X={x:v,y:Y};if(f&&f.length===q.getPoints().size()||(Wj(D),f=L.$15l),n._shape===q&&n._hoverSegmentIndex>=0){var d=q.getSegments();d||(d=gn(f));var R=_._editInteractor._hoverSegmentIndex,A=d.get(R),P=rb(q,D,R),W=G;if(P!=G&&P>=0){var Z=f[P],y=_.getSegmentHoverWidth()/M;if(2===A||1===A){var B=f[P+1];W=xq(new Cq(Z.x,Z.y),new Cq(B.x,B.y),new Cq(X.x-y,X.y-y),new Cq(X.x+2*y,X.y+2*y)),W.$62l===p&&(g=!0)}else if(3===A){var $=f[P+1],B=f[P+2];W=eh(new Cq(Z.x,Z.y),new Cq($.x,$.y),new Cq(B.x,B.y),new Cq(X.x-y,X.y-y),new Cq(X.x+2*y,X.y+2*y)),W.$62l===p&&(g=!0)}else if(4===A){var x=f[P+1],a=f[P+2];B=f[P+3],W=Un(new Cq(Z.x,Z.y),new Cq(x.x,x.y),new Cq(a.x,a.y),new Cq(B.x,B.y),new Cq(X.x-y,X.y-y),new Cq(X.x+2*y,X.y+2*y)),W.$62l===p&&(g=!0)}}}if(g)return!0}return G},b._48O=function(){var C=this,g=C.gv,x=g._editInteractor;x instanceof c.XEditInteractor?(v._48O.call(C),C._55O._43O&&Wj(C)):Lm.call(C)},b._79o=function(){var f=this,x=f.gv,J=x.getZoom(),e=x._editInteractor,L=Wg.call(f);if(L){var v={x:L.x,y:L.y,width:L.width,height:L.height};if(e instanceof c.XEditInteractor){var D=f._55O,t=x.getEditPointSize()/J+2,p=0;D&&D._43O&&(p+=t/2,h(v,p))}return v}},v._47O=function(d){var P=this,o=P.gv,_=o._editInteractor;if(_ instanceof c.XEditInteractor);else{var H=P._55O;H&&H._98o&&zd.call(P,d)}},v._2o=function(){var I=this,S=I.gv,C=S._editInteractor,o=I._data;return S.isEditable(o)&&C instanceof c.XEditInteractor?0:Tk.call(I)},v._80o=function(O){var M=this,R=M.gv._editInteractor;if(ed.call(M,O),R&&R._debug){O.save(),O.beginPath(),O.lineWidth=1,O.strokeStyle="green";var y=M._79o();y&&(O.rect(y.x,y.y,y.width,y.height),O.stroke()),O.restore()}},b._80o=function(h){var f=this,I=f.gv._editInteractor;if(Ae.call(f,h),I&&I._debug){h.save(),h.beginPath(),h.lineWidth=1,h.strokeStyle="green";var u=f._79o();h.rect(u.x,u.y,u.width,u.height),h.stroke(),h.restore()}},v._48O=function(){var N=this,I=N.gv,m=N._data,W=I._editInteractor,z=N._55O,t=m.p(),j=m.getRotation();if(W instanceof c.XEditInteractor){if(z._42O){var o=Ni(t,m.getWidth(),m.getHeight(),j),C=o[0],f=o[1],x=o[2],h=o[3],d=o[4],$=o[5],F=o[6],b=o[7];z.$45l=[C,d,f,$,h,F,x,b]}}else oi.call(N)},q.getResizeMode=function(){return this.$25l||"normal"},q.setResizeMode=function(M){var l=this.$25l;this.$25l=M,this.fp("resizeMode",l,M)},q.getSnapAngle=function(){return this.$26l||Math.PI/36},q.setSnapAngle=function(K){var y=this.$26l;this.$26l=K,this.fp("snapAngle",y,K)},q.getSnapSpacing=function(){return this.$27l},q.setSnapSpacing=function(R){var P=this.$27l;this.$27l=R,this.fp("snapSpacing",P,R)},q.getPointSnapSpacing=function(){return this._pointSnapSpacing},q.setPointSnapSpacing=function(f){var V=this._pointSnapSpacing;this._pointSnapSpacing=f,this.fp("pointSnapSpacing",V,f)},q.setHelperEditableFunc=function(i){var j=this._helperEditableFunc;this._helperEditableFunc=i,this.fp("helperEditableFunc",j,i)},q.getHelperEditableFunc=function(){return this._helperEditableFunc},q.setLeftTopHelpers=function(J){var x=this._leftTopHelpers;this._leftTopHelpers=J,this.fp("leftTopHelpers",x,J)},q.getLeftTopHelpers=function(){return this._leftTopHelpers},q.setLeftTopHelpersAlign=function(s){var r=this._leftTopHelpersAlign;this._leftTopHelpersAlign=s,this.fp("leftTopHelpersAlign",r,s)},q.getLeftTopHelpersAlign=function(){return this._leftTopHelpersAlign},q.setRightTopHelpers=function(k){var h=this._rightTopHelpers;this._rightTopHelpers=k,this.fp("rightTopHelpers",h,k)},q.getRightTopHelpers=function(){return this._rightTopHelpers},q.setRightTopHelpersAlign=function(U){var b=this._rightTopHelpersAlign;this._rightTopHelpersAlign=U,this.fp("rightTopHelpersAlign",b,U)},q.getRightTopHelpersAlign=function(){return this._rightTopHelpersAlign},q.setLeftBottomHelpers=function($){var R=this._leftBottomHelpers;this._leftBottomHelpers=$,this.fp("leftBottomHelpers",R,$)},q.getLeftBottomHelpers=function(){return this._leftBottomHelpers},q.setLeftBottomHelpersAlign=function(G){var E=this._leftBottomHelpersAlign;this._leftBottomHelpersAlign=G,this.fp("leftBottomHelpersAlign",E,G)},q.getLeftBottomHelpersAlign=function(){return this._leftBottomHelpersAlign},q.setRightBottomHelpers=function(o){var $=this._rightBottomHelpers;this._rightBottomHelpers=o,this.fp("rightBottomHelpers",$,o)},q.getRightBottomHelpers=function(){return this._rightBottomHelpers},q.setRightBottomHelpersAlign=function(E){var I=this._rightBottomHelpersAlign;this._rightBottomHelpersAlign=E,this.fp("rightBottomHelpersAlign",I,E)},q.getRightBottomHelpersAlign=function(){return this._rightBottomHelpersAlign},q.setEdgeHelpers=function(p){var R=this._edgeHelpers;this._edgeHelpers=p,this.fp("edgeHelpers",R,p)},q.getEdgeHelpers=function(){return this._edgeHelpers},q.isHelperEditable=function(T,r){return T instanceof L&&("host"===r||"edge"===r||"elevation"===r||"tall"===r)?!1:T instanceof S&&("source"===r||"target"===r)?!1:"pointElevation"===r?this._helperEditableFunc?this._helperEditableFunc(T,r):!1:this._helperEditableFunc?this._helperEditableFunc(T,r):!0},q.getEditHelperSize=function(){return this._editHelperSize||(m?28:16)},q.setEditHelperSize=function(s){var A=this._editHelperSize;this._editHelperSize=s,this.fp("editHelperSize",A,s)},q.getEditRectBorderColor=function(){return this.$28l||"rgb(0, 168, 255)"},q.setEditRectBorderColor=function(t){var h=this.$28l;this.$28l=t,this.fp("editRectBorderColor",h,t)},q.getNodeBorderColor=function(){return this.$29l||"#1ABC9C"},q.setNodeBorderColor=function(Z){var g=this.$29l;this.$29l=Z,this.fp("nodeBorderColor",g,Z)},q.getEditRectBorderStyle=function(){return this.$30l||"dashed"},q.setEditRectBorderStyle=function(t){var G=this.$30l;this.$30l=t,this.fp("editRectBorderStyle",G,t)},q.getControlPointBackground=function(){return this.$31l||"#ff0"},q.setControlPointBackground=function(i){var I=this.$31l;this.$31l=i,this.fp("controlPointBackground",I,i)},q.getControlPointBorderColor=function(){return this.$32l||this._editPointBorderColor},q.setControlPointBorderColor=function(I){var g=this.$32l;this.$32l=I,this.fp("controlPointBorderColor",g,I)},q.getJoinPointBackground=function(){return this.$33l||this._editPointBackground},q.setJoinPointBackground=function(C){var Q=this.$33l;this.$33l=C,this.fp("joinPointBackground",Q,C)},q.getJoinPointBorderColor=function(){return this.$34l||this._editPointBorderColor},q.setJoinPointBorderColor=function(d){var M=this.$34l;this.$34l=d,this.fp("joinPointBorderColor",M,d)},q.getDirectionLineColor=function(){return this.$35l||"#888"},q.setDirectionLineColor=function(m){var O=this.$35l;this.$35l=m,this.fp("directionLineColor",O,m)},q.getSegmentHoverColor=function(){return this.$36l||"rgba(255, 0, 0, 0.3)"},q.setSegmentHoverColor=function(P){var v=this.$36l;this.$36l=P,this.fp("segmentHoverColor",v,P)},q.getSegmentHoverWidth=function(){return this.$22l||(m?16:8)},q.setSegmentHoverWidth=function(S){var d=this.$22l;this.$22l=S,this.fp("segmentHoverWidth",d,S)},q.getSnapPointBorderColor=function(){return this.$38l||"#f00"},q.setSnapPointBorderColor=function(g){var d=this.$38l;this.$38l=g,this.fp("snapPointBorderColor",d,g)},q.getEditRectPadding=function(){return this.$39l!=G?this.$39l:6},q.setEditRectPadding=function(I){var s=this.$39l;this.$39l=I,this.fp("editRectPading",s,I)},q.isRectEditable=function(a){var U=this,o=U._editInteractor;return o instanceof c.XEditInteractor?U._rectEditableFunc?U._rectEditableFunc(a):!0:Dg.call(U,a)},q.isPointEditable=function(r){var O=this,N=O._editInteractor;return N instanceof c.XEditInteractor?O._pointEditableFunc?O._pointEditableFunc(r):!0:Md.call(O,r)},q.validateImpl=function(){var u=this,b=u.$14l,h=u._editInteractor;if(b){var k=u.getWidth(),X=u.getHeight();(k!==b.clientWidth||X!==b.clientHeight)&&(h&&(h._68I=1),J.setCanvas(b,k,X),u._32I=1)}Vn.call(this)},q.isEditable=function(x){var R=Eg.call(this,x),p=this._editInteractor;if(p instanceof c.XEditInteractor&&x instanceof L){x.getSource()==x.getTarget()&&(R=!1);var n=this.getEditableFunc();R=n?n(x):!0}return R},q._42=function(F,V){var W=this,T=W._editInteractor;Oe.call(W,F,V),T instanceof c.XEditInteractor&&T._68I&&T._42()},q.isSnapPoint=function(){return!0};var qe=function(b){arguments.length>0&&this.$58l(b)},ph=qe.prototype;ph.$58l=function(_){this.$62l=_,this.points=new Array},ph.$56l=function(S){this.points.push(S)},ph.$57l=function(q){this.points=this.points.concat(q)};var Cq=function(r,c){arguments.length>0&&this.$58l(r,c)},sq=Cq.prototype;sq.$58l=function(t,m){this.x=t,this.y=m},sq.add=function(F){return new Cq(this.x+F.x,this.y+F.y)},sq.addEquals=function(O){return this.x+=O.x,this.y+=O.y,this},sq.$55l=function(U){return new Cq(this.x*U,this.y*U)},sq.eq=function(b){return this.x==b.x&&this.y==b.y},sq.lt=function(Z){return this.x<Z.x&&this.y<Z.y},sq.lte=function(C){return this.x<=C.x&&this.y<=C.y},sq.gt=function(y){return this.x>y.x&&this.y>y.y},sq.gte=function(K){return this.x>=K.x&&this.y>=K.y},sq.lerp=function(S,f){return new Cq(this.x+(S.x-this.x)*f,this.y+(S.y-this.y)*f)},sq.distanceFrom=function(V){var U=this.x-V.x,J=this.y-V.y;return n(U*U+J*J)},sq.min=function(S){return new Cq(R(this.x,S.x),R(this.y,S.y))},sq.max=function(a){return new Cq(s(this.x,a.x),s(this.y,a.y))},sq.toString=function(){return this.x+","+this.y};var nk=function(){this.$58l(arguments)},pk=nk.prototype;nk.TO=1e-6,nk.AC=6,pk.$58l=function(q){this.co=new Array;for(var H=q.length-1;H>=0;H--)this.co.push(q[H])},pk.$55l=function(H){for(var E=new nk,R=0;R<=this.$50l()+H.$50l();R++)E.co.push(0);for(var R=0;R<=this.$50l();R++)for(var c=0;c<=H.$50l();c++)E.co[R+c]+=this.co[R]*H.co[c];return E},pk.$59l=function(){for(var P=this.$50l();P>=0&&d(this.co[P])<=nk.TO;P--)this.co.pop()},pk.$50l=function(){return this.co.length-1},pk.$51l=function(){var X;switch(this.$59l(),this.$50l()){case 0:X=new Array;break;case 1:X=this.$52l();break;case 2:X=this.$53l();break;case 3:X=this.$54l();break;case 4:X=this.$63l();break;default:X=new Array}return X},pk.$52l=function(){var S=new Array,E=this.co[1];return 0!=E&&S.push(-this.co[0]/E),S},pk.$53l=function(){var H=new Array;if(2==this.$50l()){var e=this.co[2],w=this.co[1]/e,l=this.co[0]/e,b=w*w-4*l;if(b>0){var f=n(b);H.push(.5*(-w+f)),H.push(.5*(-w-f))}else 0==b&&H.push(.5*-w)}return H},pk.$63l=function(){var Z=new Array;if(4==this.$50l()){var x=this.co[4],I=this.co[3]/x,y=this.co[2]/x,g=this.co[1]/x,i=this.co[0]/x,B=new nk(1,-y,I*g-4*i,-I*I*i+4*y*i-g*g).$54l(),r=B[0],C=I*I/4-y+r;if(d(C)<=nk.TO&&(C=0),C>0){var E=n(C),U=3*I*I/4-E*E-2*y,H=(4*I*y-8*g-I*I*I)/(4*E),q=U+H,F=U-H;if(d(q)<=nk.TO&&(q=0),d(F)<=nk.TO&&(F=0),q>=0){var l=n(q);Z.push(-I/4+(E+l)/2),Z.push(-I/4+(E-l)/2)}if(F>=0){var l=n(F);Z.push(-I/4+(l-E)/2),Z.push(-I/4-(l+E)/2)}}else if(0>C);else{var H=r*r-4*i;if(H>=-nk.TO){if(0>H&&(H=0),H=2*n(H),U=3*I*I/4-2*y,U+H>=nk.TO){var D=n(U+H);Z.push(-I/4+D/2),Z.push(-I/4-D/2)}if(U-H>=nk.TO){var D=n(U-H);Z.push(-I/4+D/2),Z.push(-I/4-D/2)}}}}return Z},pk.$54l=function(){var v=new Array;if(3==this.$50l()){var I=this.co[3],B=this.co[2]/I,j=this.co[1]/I,H=this.co[0]/I,o=(3*j-B*B)/3,e=(2*B*B*B-9*j*B+27*H)/27,Y=B/3,D=e*e/4+o*o*o/27,z=e/2;if(d(D)<=nk.TO&&(D=0),D>0){var J,T,V=n(D);J=-z+V,T=J>=0?a(J,1/3):-a(-J,1/3),J=-z-V,J>=0?T+=a(J,1/3):T-=a(-J,1/3),v.push(T-Y)}else if(0>D){var K=n(-o/3),E=_(n(-D),-z)/3,W=r(E),P=Z(E),L=n(3);v.push(2*K*W-Y),v.push(-K*(W+L*P)-Y),v.push(-K*(W-L*P)-Y)}else{var J;J=z>=0?-a(z,1/3):a(-z,1/3),v.push(2*J-Y),v.push(-J-Y)}}return v};var Bs=function(W,F){arguments.length>0&&this.$58l(W,F)},km=Bs.prototype;km.$58l=function(V,q){this.x=V,this.y=q},km.length=function(){return n(this.x*this.x+this.y*this.y)},km.$60l=function(F){return this.x*F.x+this.y*F.y};var xi=function(o,J,r,v){var O,U=(v.x-r.x)*(o.y-r.y)-(v.y-r.y)*(o.x-r.x),f=(J.x-o.x)*(o.y-r.y)-(J.y-o.y)*(o.x-r.x),A=(v.y-r.y)*(J.x-o.x)-(v.x-r.x)*(J.y-o.y);if(0!=A){var n=U/A,N=f/A;n>=0&&1>=n&&N>=0&&1>=N?(O=new qe(p),O.points.push(new Cq(o.x+n*(J.x-o.x),o.y+n*(J.y-o.y)))):O=new qe(W)}else O=0==U||0==f?new qe("C"):new qe("P");return O},Bo=function(k,d,a,g,M){var S,z,K,E,n,i,D,V=g.min(M),A=g.max(M),U=new qe(W);S=d.$55l(-2),K=k.add(S.add(a)),S=k.$55l(-2),z=d.$55l(2),E=S.add(z),n=new Cq(k.x,k.y),D=new Bs(g.y-M.y,M.x-g.x),i=g.x*M.y-M.x*g.y;for(var I=new nk(D.$60l(K),D.$60l(E),D.$60l(n)+i).$51l(),N=0;N<I.length;N++){var R=I[N];if(R>=0&&1>=R){var $=k.lerp(d,R),w=d.lerp(a,R),s=$.lerp(w,R);g.x==M.x?V.y<=s.y&&s.y<=A.y&&(U.$62l=p,U.$56l(s)):g.y==M.y?V.x<=s.x&&s.x<=A.x&&(U.$62l=p,U.$56l(s)):s.gte(V)&&s.lte(A)&&(U.$62l=p,U.$56l(s))}}return U},eh=function(e,q,O,d,C){var U=d.min(C),S=d.max(C),v=new Cq(S.x,U.y),n=new Cq(U.x,S.y),Q=Bo(e,q,O,U,v),P=Bo(e,q,O,v,S),A=Bo(e,q,O,S,n),T=Bo(e,q,O,n,U),Z=new qe(W);return Z.$57l(Q.points),Z.$57l(P.points),Z.$57l(A.points),Z.$57l(T.points),Z.points.length>0&&(Z.$62l=p),Z},Ar=function(s,i,X,V,H,n){var o,O,z,e,C,U,v,Q,k,P,h=H.min(n),B=H.max(n),m=new qe(W);o=s.$55l(-1),O=i.$55l(3),z=X.$55l(-3),e=o.add(O.add(z.add(V))),C=new Bs(e.x,e.y),o=s.$55l(3),O=i.$55l(-6),z=X.$55l(3),e=o.add(O.add(z)),U=new Bs(e.x,e.y),o=s.$55l(-3),O=i.$55l(3),z=o.add(O),v=new Bs(z.x,z.y),Q=new Bs(s.x,s.y),P=new Bs(H.y-n.y,n.x-H.x),k=H.x*n.y-n.x*H.y;for(var y=new nk(P.$60l(C),P.$60l(U),P.$60l(v),P.$60l(Q)+k).$51l(),Y=0;Y<y.length;Y++){var J=y[Y];if(J>=0&&1>=J){var F=s.lerp(i,J),A=i.lerp(X,J),t=X.lerp(V,J),$=F.lerp(A,J),I=A.lerp(t,J),L=$.lerp(I,J);H.x==n.x?h.y<=L.y&&L.y<=B.y&&(m.$62l=p,m.$56l(L)):H.y==n.y?h.x<=L.x&&L.x<=B.x&&(m.$62l=p,m.$56l(L)):L.gte(h)&&L.lte(B)&&(m.$62l=p,m.$56l(L))}}return m},Un=function(k,T,A,i,$,I){var L=$.min(I),l=$.max(I),h=new Cq(l.x,L.y),e=new Cq(L.x,l.y),Z=Ar(k,T,A,i,L,h),q=Ar(k,T,A,i,h,l),X=Ar(k,T,A,i,l,e),_=Ar(k,T,A,i,e,L),b=new qe(W);return b.$57l(Z.points),b.$57l(q.points),b.$57l(X.points),b.$57l(_.points),b.points.length>0&&(b.$62l=p),b},xq=function(c,_,G,u){var g=G.min(u),m=G.max(u),S=new Cq(m.x,g.y),d=new Cq(g.x,m.y),H=xi(g,S,c,_),b=xi(S,m,c,_),z=xi(m,d,c,_),L=xi(d,g,c,_),t=new qe(W);return t.$57l(H.points),t.$57l(b.points),t.$57l(z.points),t.$57l(L.points),t.points.length>0&&(t.$62l=p),t},bn=c.XEditInteractor=function(j){var Q=this,S=Q._view=document.createElement("canvas");S.className="editCanvas",S.style.position="absolute",bn.superClass.constructor.call(Q,j)};j.def(bn,c.Interactor,{ms_edit:1,setUp:function(){var Y=this,m=Y.gv,X=m.getView(),j=Y._view;bn.superClass.setUp.call(Y),m.setEditInteractor(Y),m.$14l=j,m._79O?X.insertBefore(j,m._79O):X.appendChild(j);var C=Y.$49l=Y.$11l.bind(Y);m.dm().md(C),m.sm().ms(C),m.mp(C)},tearDown:function(){var $=this,K=$.gv,y=K.getView(),b=$.$49l;bn.superClass.tearDown.call($),K.setEditInteractor(G),K.$14l=G,y.removeChild($._view),K.dm().umd(b),K.sm().ums(b),K.ump(b)},clear:function(){var R=this,q=R.gv;delete R._hoverSegmentIndex,delete R._edge,delete R._shape,delete q._editing,delete R.$10l,delete R.$13l,delete R.$9l,delete R._removePointIndex,delete R._lp,R.$12l="",delete R.$40l,delete R.$67l,delete R.$72l,delete R.$73l,delete R.$75l,delete R.$1l,delete R.$3l,delete R.$2l,delete R.$92l,delete R.$93l,delete R.$94l,R.clearDragging()},handle_keydown:function(K){this.$48l!==K.shiftKey&&(this.$48l=K.shiftKey,this.handle_mousemove(K,u,!0))},handle_keyup:function(Q){this.$48l!==Q.shiftKey&&(this.$48l=Q.shiftKey,this.handle_mousemove(Q,u,!0))},handle_touchstart:function(_){this.handle_mousemove(_),this.handle_mousedown(_)},handle_mousedown:function(p){Y(p);var q=this,y=q.$13l,P=q.gv,I=P.dm(),$=I.getHistoryManager(),U=P.sm(),u=P.getZoom(),L=P.lp(p),D=j.isDoubleClick(p),z=j.isLeftButton(p),R=q.$7l,d=q._shape,h=q._hoverSegmentIndex,A=q._edge,r=q.$87l,l=q.$88l,e=function(){q._68I||r===q.$87l&&l===q.$88l||q.$43l()};if(7!==q.$67l&&(delete q.$87l,delete q.$88l),z&&(d||A)&&h>=0&&D&&(d&&U.contains(d)||A&&U.contains(A))){var X=Qb.call(q,d||A,h,L);return q.addShapePoint(d||A,h,X),T(function(){q.handle_mousemove(p)},40),void 0}if(z&&(d||A)&&q._removePointIndex>=0&&D)return q.removeShapePoint(),q.$5l=1,T(function(){q.handle_mousemove(p)},40),void 0;if(!z||!P._editing)return e(),void 0;if(d&&y>=0){var c=d.getPoints().get(y),w=d.p(),x=$d(w,c.x-w.x,c.y-w.y,-R+d.getRotation());n=$d(w,L.x-w.x,L.y-w.y,-R),q.$24l={x:n.x-x.x,y:n.y-x.y},q.startDragging(p),$&&$.beginInteraction(),q.fi({kind:"beginEditPoint",event:p,data:d,index:y}),q.$88l=y,q.$87l=d}else if(q.$10l){var N=P.sm().getSelection(),W=q.$6l,s=q.$1l={},O=q.$3l={},o=q.$16l[C[q.$10l]],k={x:W.x,y:W.y},b={x:W.x+W.width/2,y:W.y+W.height/2};q.$24l={x:L.x-o.x/u,y:L.y-o.y/u},q.$2l=M(q.$8l),q.$4l=M(W),N.each(function(p){if(p instanceof S){var o=p.p(),z=p.getWidth(),u=p.getHeight(),H=$d(b,o.x-b.x,o.y-b.y,-R);s[p.getId()]={x:o.x-z/2,y:o.y-u/2,width:z,height:u},O[p.getId()]={x:(H.x-k.x)/W.width,y:(H.y-k.y)/W.height}}}),q.startDragging(p),$&&$.beginInteraction(),q.fi({kind:"beginEditRect",event:p,direction:q.$10l})}else if(A&&y>=0){var Z=Tj(P.getDataUI(A),A.s("edge.points")),c=Z.get(y);q.$24l={x:L.x-c.x,y:L.y-c.y},q.startDragging(p),$&&$.beginInteraction(),q.fi({kind:"beginEditPoint",event:p,data:A,index:y}),q.$88l=y,q.$87l=A}else if(q.$40l){var W=q.$6l,b={x:W.x+W.width/2,y:W.y+W.height/2},g=M(q.$23l);g.x/=u,g.y/=u;var v=$d(b,g.x-b.x,g.y-b.y,-R),n=$d(b,L.x-b.x,L.y-b.y,-R);q.$24l={x:n.x-v.x,y:n.y-v.y},q.startDragging(p),$&&$.beginInteraction(),q.fi({kind:"beginEditRotation",event:p,data:q._rotationNode})}else if([1,2,3,5,6,7,8,9].indexOf(q.$67l)>=0)q.startDragging(p);else if(q.$71l&&D&&q.$79l(q.$71l,L)){var i=U.toSelection();$&&$.beginInteraction(),i.each(function(E){I.remove(E)}),$&&$.endInteraction()}e()},$11l:function(){var l=this,x=l.gv;x._editing&&(l.$13l==G||l._shape==G&&l._edge==G)&&(l.$73l==G||1!==l.$67l&&5!==l.$67l&&6!==l.$67l)||(l.$5l=1),l._68I=1},$46l:function(s){var m=this,I=m.gv,g=I.lp(s),R=[];return vr(I,function(s){var V=I.getDataUI(s);if(V){var T=V._79o();e(T,g)&&R.push(s)}}),R},$47l:function(F){var e=this,X=e.$13l,m=e.gv.dm(),S=m.getHistoryManager();e.$10l?(e.fi({kind:"endEditRect",event:F,direction:e.$10l}),S&&S.endInteraction()):e._shape&&X>=0?(e.fi({kind:"endEditPoint",event:F,data:e._shape,index:X}),S&&S.endInteraction()):e._edge&&X>=0?(e.fi({kind:"endEditPoint",event:F,data:e._edge,index:X}),S&&S.endInteraction()):e.$23l&&e.$40l&&(e.fi({kind:"endEditRotation",event:F}),S&&S.endInteraction())},handleWindowTouchEnd:function(B){this.handleWindowMouseUp(B)},handleWindowMouseUp:function(Y){var l=this,B=l.gv,A=B.dm(),r=A.getHistoryManager(),x=l._shape,V=l._edge,W=l.$13l,$=l.$40l,P=l.$9l,h=l.$10l,I=l.$67l;if((x||V)&&W>=0&&P>=0){var Q,K;if(x){var N=x.p(),o=x.getRotation();Q=x.getPoints(),K=Q.get(P),tp(x,N,o,W,K,!1)}else if(Q=Tj(B.getDataUI(V),V.s("edge.points"),!0),K=Q.get(P),0===W){var q=Q.get(0);V.s("edge.source.offset.x",K.x-q.x),V.s("edge.source.offset.y",K.y-q.y)}else if(W===Q.size()-1){var v=Q.get(Q.size()-1);V.s("edge.target.offset.x",K.x-v.x),V.s("edge.target.offset.y",K.y-v.y)}else"points"===V.s("edge.type")&&(Q.set(W,K),V.s("edge.points",fd(Q)))}l.$47l(Y);var J=l.$73l;1===I?(r&&r.beginInteraction(),J?B.sm().each(function(X){if(X.setHost&&B.isHelperEditable(X,"host")){X.setHost(J);var p=l.$75l,h=l.$74l;p&&(X.s("attach.row.index",p.rowIndex),X.s("attach.column.index",p.columnIndex)),h&&(X.s("attach.index",h.attachIndex),X.s("attach.offset",h.attachOffset),X.s("attach.offset.relative",!1),X.s("attach.offset.opposite",!1))
}}):B.sm().each(function(X){X.setHost&&B.isHelperEditable(X,"host")&&(X.setHost(G),X.s("attach.row.index",u),X.s("attach.column.index",u),X.s("attach.index",u),X.s("attach.offset",u),X.s("attach.offset.relative",!1),X.s("attach.offset.opposite",!1))}),r&&r.endInteraction()):2===I?(r&&r.beginInteraction(),J?B.sm().each(function(i){i.setParent&&B.isHelperEditable(i,"parent")&&i.setParent(J)}):B.sm().each(function(I){I.setParent&&B.isHelperEditable(I,"parent")&&I.setParent(G)}),r&&r.endInteraction()):3===I?J&&(r&&r.beginInteraction(),B.sm().each(function(R){if(B.isHelperEditable(R,"edge")&&R instanceof S&&J instanceof S){var r=new O.Edge;A.add(r),r.setSource(R),r.setTarget(J),l.onEdgeCreated&&l.onEdgeCreated(Y,r)}}),r&&r.endInteraction()):(5===I||6===I)&&J&&(r&&r.beginInteraction(),B.sm().each(function(b){b instanceof L&&J instanceof S&&(5===I&&B.isHelperEditable(b,"source")?b.setSource(J):6===I&&B.isHelperEditable(b,"source")&&b.setTarget(J))}),r&&r.endInteraction()),(h||$)&&l.$43l(!0),m?(l.clear(),delete l.$64l,l._68I||l.$43l()):(l.handle_mousemove(Y,!0),I&&!l._68I&&l.$43l())},handleWindowTouchMove:function(p){this.handleWindowMouseMove(p)},handleWindowMouseMove:function(V){this._78I(V)},handle_mousemove:function($,X,a){if(!this._pause){if(!a){var x=m?Gg($):$;this.$61l={clientX:x.clientX,clientY:x.clientY}}if(X===!0||!F()){var t=this,J=t.gv,U=!1,k=G;t.clear(),J.sm().size()>0&&(k=J.lp(a?t.$61l:$),U=t._79I($,k)),U&&(J._editing=1),t.$12l!==t.$65l&&(t.$65l=t.$12l,t.setCursor(t.$12l)),t.$40l!==t.$64l&&(t.$64l=t.$40l,t._68I||t.$43l()),t._hoverSegmentIndex!==t.$66l&&(t.$66l=t._hoverSegmentIndex,t._68I||t.$43l())}}},_78I:function(p){this.autoScroll(p);var c=this,O=c.gv,b=O.lp(p),B=O.getZoom(),E=c.$13l;if((c._shape||c._edge)&&E>=0){var Y,k,W,i=c._shape,u=c._edge,C=c.$24l,v=O.getPointSnapSpacing(),r=function(x,k){return v==G||isNaN(v)?{x:x,y:k}:{x:K(x/v)*v,y:K(k/v)*v}};if(i){Y=i.getPoints();var H=i.p(),h=i.getRotation(),J=0;k=$d(H,b.x-H.x,b.y-H.y,-h),tp(i,H,h,E,b,!0,C,r),c.fi({kind:"betweenEditPoint",event:p,data:i,index:E})}else if(u){Y=Tj(O.getDataUI(u),u.s("edge.points"),!0),b.x-=C.x,b.y-=C.y,k=b;var V,Q;if(0===E){var A=Y.get(0);V=b.x-A.x,Q=b.y-A.y,W=r(V,Q),u.s("edge.source.offset.x",W.x),u.s("edge.source.offset.y",W.y)}else if(E===Y.size()-1){var R=Y.get(Y.size()-1);V=b.x-R.x,Q=b.y-R.y,W=r(V,Q),u.s("edge.target.offset.x",W.x),u.s("edge.target.offset.y",W.y)}else"points"===u.s("edge.type")&&(W=r(b.x,b.y),W.e=Y.get(E).e,Y.set(E,W),u.s("edge.points",fd(Y)));c.fi({kind:"betweenEditPoint",event:p,data:u,index:E})}if(delete c.$9l,O.isSnapPoint(i)||O.isSnapPoint(u))for(J=0;J<Y.size();J++)if(J!==E){var X=Y.get(J);if(P(X,k)<O.getEditPointSize()/B){c.$9l=J;break}}}else if(c.$10l){var C=c.$24l;b.x-=C.x,b.y-=C.y;var $=O.sm().getSelection(),z=c.$1l,f=c.$7l,a=c.$10l,q=c.$4l,Z=c.$2l,F=O.getEditRectPadding()/B,y=2*F,g=O.getSnapSpacing(),l=g!=G&&!isNaN(g),M=mq(Z,b,a,f,2*F,O.getResizeMode(),l,!0),o=c.$6l;if(l){var x=M.width-y,s=M.height-y,m=K(x/g)*g,t=K(s/g)*g,e=m-x,N=t-s;("west"===a||"northwest"===a||"southwest"===a)&&(e=-e),("north"===a||"northwest"===a||"northeast"===a)&&(N=-N),M=mq(Z,b,a,f,2*F,O.getResizeMode(),l,!1,e,N)}c.$8l=M,o.x=M.x+F,o.y=M.y+F,o.width=M.width-y,o.height=M.height-y;var Li=M.x+M.width/2,Qe=M.y+M.height/2,im=o.x,Wo=o.y,We=o.width/q.width,Tn=o.height/q.height;$.each(function(K){if(K instanceof S&&O.isEditable(K)&&O.isRectEditable(K)){var u=z[K.getId()],J=c.$3l[K.getId()],$={x:u.x+u.width/2,y:u.y+u.height/2},Z=0,v=0,n=a,H=180*d(f-K.getRotation())/I;"northeast"===a?H>=315||45>H?(Z=u.width*We+u.x,v=u.height*(1-Tn)+u.y,n="northeast"):H>=45&&135>H?(Z=u.width*(1-Tn)+u.x,v=u.height*(1-We)+u.y,n="northwest"):H>=135&&225>H?(Z=u.width*(1-We)+u.x,v=u.height*Tn+u.y,n="southwest"):(Z=u.width*Tn+u.x,v=u.height*We+u.y,n="southeast"):"north"===a?H>=315||45>H?(v=u.height*(1-Tn)+u.y,n="north"):H>=45&&135>H?(Z=u.width*(1-Tn)+u.x,n="west"):H>=135&&225>H?(v=u.height*Tn+u.y,n="south"):(Z=u.width*Tn+u.x,n="east"):"northwest"===a?H>=315||45>H?(Z=u.width*(1-We)+u.x,v=u.height*(1-Tn)+u.y,n="northwest"):H>=45&&135>H?(Z=u.width*(1-Tn)+u.x,v=u.height*We+u.y,n="southwest"):H>=135&&225>H?(Z=u.width*We+u.x,v=u.height*Tn+u.y,n="southeast"):(Z=u.width*Tn+u.x,v=u.height*(1-We)+u.y,n="northeast"):"west"===a?H>=315||45>H?(Z=u.width*(1-We)+u.x,n="west"):H>=45&&135>H?(v=u.height*We+u.y,n="south"):H>=135&&225>H?(Z=u.width*We+u.x,n="east"):(v=u.height*(1-We)+u.y,n="north"):"southwest"===a?H>=315||45>H?(Z=u.width*(1-We)+u.x,v=u.height*Tn+u.y,n="southwest"):H>=45&&135>H?(Z=u.width*Tn+u.x,v=u.height*We+u.y,n="southeast"):H>=135&&225>H?(Z=u.width*We+u.x,v=u.height*(1-Tn)+u.y,n="northeast"):(Z=u.width*(1-Tn)+u.x,v=u.height*(1-We)+u.y,n="northwest"):"east"===a?H>=315||45>H?(Z=u.width*We+u.x,n="east"):H>=45&&135>H?(v=u.height*(1-We)+u.y,n="north"):H>=135&&225>H?(Z=u.width*(1-We)+u.x,n="west"):(v=u.height*We+u.y,n="south"):"south"===a?H>=315||45>H?(v=u.height*Tn+u.y,n="south"):H>=45&&135>H?(Z=u.width*Tn+u.x,n="east"):H>=135&&225>H?(v=u.height*(1-Tn)+u.y,n="north"):(Z=u.width*(1-Tn)+u.x,n="west"):"southeast"===a&&(H>=315||45>H?(Z=u.width*We+u.x,v=u.height*Tn+u.y,n="southeast"):H>=45&&135>H?(Z=u.width*Tn+u.x,v=u.height*(1-We)+u.y,n="northeast"):H>=135&&225>H?(Z=u.width*(1-We)+u.x,v=u.height*(1-Tn)+u.y,n="northwest"):(Z=u.width*(1-Tn)+u.x,v=u.height*We+u.y,n="southwest"));var s=$d($,Z-$.x,v-$.y,K.getRotation());As(K,u,n,{x:s.x,y:s.y});var P=im+o.width*J.x,g=Wo+o.height*J.y,C={x:P,y:g};C=$d({x:Li,y:Qe},C.x-Li,C.y-Qe,f),K.p(C.x,C.y)}}),c.fi({kind:"betweenEditRect",event:p,direction:a})}else if(c.$23l&&c.$40l){var Oq=c.$8l,Mg=Oq.width,Tm=Oq.height,H={x:Oq.x+Mg/2,y:Oq.y+Tm/2},C=c.$24l,$p=c.$23l,ng=$p.x/B-H.x,pe=$p.y/B-H.y,jr=n(ng*ng+pe*pe),Gf=Math.asin(C.x/jr),Bh=O.sm().getSelection(),Eq=D+_(b.y-H.y,b.x-H.x)-Gf,Wl=O.getSnapAngle(),Eq=K(Eq/Wl)*Wl;0>Eq&&(Eq+=w);var Sk=Eq-c.$7l,Yg=[H.x,0,H.y];Bh.each(function(e){if(O.isEditable(e)&&O.isRotationEditable(e)&&O.isVisible(e)){var m=Xr(e.p3(),Yg),o=sl();Fe(o,-Sk),e.setRotation(e.getRotation()+Sk),fn(m,o),e.p3(Yg[0]+m[0],Yg[1]+m[1],Yg[2]+m[2])}}),c.$7l=Eq,c.fi({kind:"betweenEditRotation",event:p})}else if([1,2,3,5,6].indexOf(c.$67l)>=0)c.$72l=p,c.$78l||(c.$78l=1,T(function(){j.isDragging()&&c.$43l(),delete c.$78l},12));else if(7===c.$67l){if(c.$87l instanceof U){var i=c.$87l,Vf=c.$88l,_g=j.clone(i.getPoints().get(Vf)),Zq=b.y-_g.y;_g.e||(_g.e=0),c.$92l||(c.$92l=_g.e),_g.e=c.$92l-Zq,i.setPoint(Vf,_g)}else if(c.$87l instanceof L){var u=c.$87l,Vf=c.$88l,Y=Tj(O.getDataUI(u),u.s("edge.points")),_g=Y.get(Vf),Zq=b.y-_g.y;_g.e||(_g.e=0),c.$92l||(c.$92l=_g.e),_g.e=c.$92l-Zq,Y.set(Vf,_g),u.s("edge.points",fd(Y))}}else if(8===c.$67l){var Bh=O.sm().getSelection(),ee=c.$93l;ee||(ee=c.$93l={}),Bh.each(function(g){if(g.p3){var d=g.p3(),$=ee[g.getId()];$==G&&($=ee[g.getId()]=d[1]),g.p3([d[0],$-(b.y-c.$90l.y/B),d[2]])}})}else if(9===c.$67l){var Bh=O.sm().getSelection(),_c=c.$94l;_c||(_c=c.$94l={}),Bh.each(function(S){if(S.s3){var g=S.s3(),h=_c[S.getId()];h==G&&(h=_c[S.getId()]=g[1]);var O=h-(b.y-c.$91l.y/B);0>O&&(O=.01),S.s3([g[0],O,g[2]])}})}},$79l:function(k,n){var o=this,D=o.gv,d=D.getZoom(),I=D.getEditHelperSize(),Z=k.x/d,u=k.y/d,X=I/d,E=X/2;return e({x:Z-E,y:u-E,width:X,height:X},n)?!0:void 0},_79I:function(w,f){var g=this,b=g.gv,B=b.getZoom(),y=b.getEditPointSize(),u=y/B,c=u/2;if(g.$16l){var h,d=g.$16l,C=d[3].x-d[7].x,p=d[3].y-d[7].y,v=n(C*C+p*p),J=d[1].x-d[5].x,F=d[1].y-d[5].y,m=n(J*J+F*F),K={x:f.x*B,y:f.y*B};if(g._80I(K,0,d[0],"northwest",v,m)||g._80I(K,1,d[1],"north",v,m)||g._80I(K,2,d[2],"northeast",v,m)||g._80I(K,7,d[7],"west",v,m)||g._80I(K,3,d[3],"east",v,m)||g._80I(K,6,d[6],"southwest",v,m)||g._80I(K,5,d[5],"south",v,m)||g._80I(K,4,d[4],"southeast",v,m))return!0}if(g.$23l){var o=g.$23l,t=o.x/B,G=o.y/B;if(e({x:t-c,y:G-c,width:u,height:u},f))return g.$40l=1,g.$12l="crosshair",!0}if(g.$68l&&g.$79l(g.$68l,f))return g.$67l=1,g.$12l="crosshair",!0;if(g.$69l&&g.$79l(g.$69l,f))return g.$67l=2,g.$12l="crosshair",!0;if(g.$70l&&g.$79l(g.$70l,f))return g.$67l=3,g.$12l="crosshair",!0;if(g.$71l&&g.$79l(g.$71l,f))return g.$67l=4,g.$12l="crosshair",!0;if(g.$82l&&g.$79l(g.$82l,f))return g.$67l=5,g.$12l="crosshair",!0;if(g.$83l&&g.$79l(g.$83l,f))return g.$67l=6,g.$12l="crosshair",!0;if(g._pointElevationHelperPoint&&g.$79l(g._pointElevationHelperPoint,f))return g.$67l=7,g.$12l="crosshair",!0;if(g.$90l&&g.$79l(g.$90l,f))return g.$67l=8,g.$12l="crosshair",!0;if(g.$91l&&g.$79l(g.$91l,f))return g.$67l=9,g.$12l="crosshair",!0;for(var k=g.$46l(w),r=0;r<k.length;r++){var h,X,W=k[r],l=b.getDataUI(W);if(l&&l._55O){var q=l._55O;if(q._43O&&W instanceof L){if(h=W.s("edge.points"),h=Tj(l,h),X=W.s("edge.segments"),X||(X=gn(h)),g.$42l(W,f,h._as,X,"edge"))return!0;"points"===W.s("edge.type")&&g.$41l(W,f,h._as,X,"edge")}if(q._43O&&W instanceof U&&q.$15l&&q.$15l.length===W.getPoints().size()){if(h=q.$15l,X=W.getSegments(),X||(X=gn(h)),g.$42l(W,f,h,X,"shape"))return!0;g.$41l(W,f,h,X,"shape")}}}return!1},_80I:function(Z,G,g,h,w,W){var b=this,Q=b.gv,f=Q.getEditPointSize(),n=f/2,u=Q.sm(),d=Q.isDirectionEditable;if(d&&1===u.size()){var C=u.ld();if(d=d.bind(Q),C instanceof S){if(!d(C,h))return!1;if("east"===h){if(d(C,"northeast")&&d(C,"southeast")&&2*f>=W)return!1}else if("west"===h){if(d(C,"northwest")&&d(C,"southwest")&&2*f>=W)return!1}else if("north"===h){if(d(C,"northwest")&&d(C,"northeast")&&2*f>=w)return!1}else if("south"===h&&d(C,"southwest")&&d(C,"southeast")&&2*f>=w)return!1}}else{if(2*f>=w&&("north"===h||"south"===h))return!1;if(2*f>=W&&("east"===h||"west"===h))return!1}if(e({x:g.x-n,y:g.y-n,width:f,height:f},Z)){if(b.$10l!==h){var V=180*b.$7l/I,K="";V>=337.5||22.5>V?K="north":V>=22.5&&67.5>V?K="northeast":V>=67.5&&112.5>V?K="east":V>=112.5&&157.5>V?K="southeast":V>=157.5&&202.5>V?K="south":V>=202.5&&247.5>V?K="southwest":V>=247.5&&292.5>V?K="west":V>=292.5&&337.5>V&&(K="northwest");var i=Ap.indexOf(K),K=Ap[G-(1-i)+8];switch(K){case"northwest":b.$12l="nwse-resize";break;case"northeast":b.$12l="nesw-resize";break;case"southwest":b.$12l="nesw-resize";break;case"southeast":b.$12l="nwse-resize";break;case"north":b.$12l="ns-resize";break;case"east":b.$12l="ew-resize";break;case"south":b.$12l="ns-resize";break;case"west":b.$12l="ew-resize"}b.$10l=h}return!0}return!1},$42l:function(g,M,L,v,G){var A,c=this,C=c.gv,j=C.getEditPointSize(),o=j/C.getZoom(),E=-1,p={x:M.x,y:M.y,width:0,height:0},q=function(t){"shape"===G?c._shape=g:c._edge=g,c._removePointIndex=t},x=function(l){"shape"===G?c._shape=g:c._edge=g,c.$13l=l,c.$12l="crosshair"};for(h(p,o/2),E=L.length-1,A=v.size()-1;A>=0;A--){var H=v.get(A);if(1===H||2===H)E-=1;else if(3===H){var T=L[E-1];if(e(p,T))return x(E-1),!0;E-=2}else if(4===H){var b=L[E-1],U=L[E-2];if(e(p,b))return x(E-1),!0;if(e(p,U))return x(E-2),!0;E-=3}}for(E=L.length-1,A=v.size()-1;A>=0;A--){var H=v.get(A),y=L[E];if(e(p,y))return q(E),x(E),!0;1===H||2===H?E-=1:3===H?E-=2:4===H&&(E-=3)}return!1},$41l:function(V,X,_,G,R){var u=this,j=u.gv,Z=-1,H=0,m={x:X.x,y:X.y,width:0,height:0},k=function(r,G){u._hoverSegmentIndex=G,u._lp=X,"shape"===R?u._shape=V:u._edge=V};for(h(m,j.getSegmentHoverWidth()/2/j.getZoom()),V instanceof U&&V.isClosePath()&&G.indexOf(5)<0&&(G=new l(G._as),G.add(5));H<G.size();H++){var d=G.get(H);if(1===d){var N=_[Z],x=_[Z+1];if(N){var s=xq(new Cq(N.x,N.y),new Cq(x.x,x.y),new Cq(m.x,m.y),new Cq(m.x+m.width,m.y+m.height));if(s.$62l===p&&s.points.length>0)return k(s,H),!0}Z+=1}else if(2===d){var N=_[Z],x=_[Z+1],s=xq(new Cq(N.x,N.y),new Cq(x.x,x.y),new Cq(m.x,m.y),new Cq(m.x+m.width,m.y+m.height));if(s.$62l===p&&s.points.length>0)return k(s,H),!0;Z+=1}else if(3===d){var N=_[Z],S=_[Z+1],y=_[Z+2],s=eh(new Cq(N.x,N.y),new Cq(S.x,S.y),new Cq(y.x,y.y),new Cq(m.x,m.y),new Cq(m.x+m.width,m.y+m.height));if(s.$62l===p)return k(s,H),!0;Z+=2}else if(4===d){var N=_[Z],i=_[Z+1],w=_[Z+2],y=_[Z+3],s=Un(new Cq(N.x,N.y),new Cq(i.x,i.y),new Cq(w.x,w.y),new Cq(y.x,y.y),new Cq(m.x,m.y),new Cq(m.x+m.width,m.y+m.height));if(s.$62l===p)return k(s,H),!0;Z+=3}else if(5===d){var N=_[Z],x=_[0];if(N){var s=xq(new Cq(N.x,N.y),new Cq(x.x,x.y),new Cq(m.x,m.y),new Cq(m.x+m.width,m.y+m.height));if(s.$62l===p&&s.points.length>0)return k(s,H),!0}}}return!1},addShapePoint:function(K,t,h){var _=this,T=_.gv,d=T.dm(),z=d.getHistoryManager();if(z&&z.beginInteraction(),0===arguments.length&&(K=_._shape||_._edge,t=_._hoverSegmentIndex,h=_._lp),K instanceof U||K instanceof L){var A=rb(K,T.getDataUI(K),t);if(!isNaN(t)&&h&&!isNaN(A)){var b=h;if(K instanceof U){var I=K.p(),G=K.getRotation(),Y=K.toSegments();Y||(Y=gn(K.getPoints())),K.isClosePath()&&Y.indexOf(5)<0&&(Y=new l(Y._as),Y.add(5));var v=Y.get(t),N="addPoint",J="removePointAt";if(2===v||1===v){var q={x:b.x,y:b.y};Y.add(v,t),q=$d(I,q.x-I.x,q.y-I.y,-G),K[N](q,A+1)}else if(3===v){var R=K.getPoints(),y=R.get(A),W=R.get(A+2),q={x:b.x,y:b.y};q=$d(I,q.x-I.x,q.y-I.y,-G);var k=Wl(y,q),w=Wl(q,W);Y.removeAt(t),Y.add(3,t),Y.add(3,t),K.setPoint(A+1,q),K[N](w,A+2),K[N](k,A+1)}else if(4===v){var R=K.getPoints(),y=R.get(A),W=R.get(A+3),q={x:b.x,y:b.y};q=$d(I,q.x-I.x,q.y-I.y,-G);var k=ws(y,q),w=ce(y,q),O=ws(q,W),u=ce(q,W);Y.removeAt(t),Y.add(4,t),Y.add(4,t),K[J](A+1),K[J](A+1),K[N](q,A+1),K[N](u,A+2),K[N](O,A+2),K[N](w,A+1),K[N](k,A+1)}else if(5===v){var q={x:b.x,y:b.y};Y.add(2,t),q=$d(I,q.x-I.x,q.y-I.y,-G),K[N](q,A+1)}K.isClosePath()&&Y.remove(5),K.setSegments(Y);var e=K.getWidth(),c=K.getHeight(),B=K.p().x-e/2,n=K.p().y-c/2;B-=I.x,n-=I.y;var D=fp(K,{x:B,y:n,width:e,height:c},G,I);K.p(D.x,D.y)}else if(K instanceof L){if("points"!==K.s("edge.type"))return z&&z.endInteraction(),void 0;var R=K.s("edge.points");Y=K.s("edge.segments"),R=Tj(T.getDataUI(K),R),Y||(Y=gn(R)),Y=new l(Y._as.slice(0)),R=new l(R._as.slice(0));var v=Y.get(t);if(2===v||1===v){var q={x:b.x,y:b.y};Y.add(v,t),R.add(q,A+1)}else if(3===v){var y=R.get(A),W=R.get(A+2),q={x:b.x,y:b.y},k=Wl(y,q),w=Wl(q,W);Y.removeAt(t),Y.add(3,t),Y.add(3,t),R.set(A+1,q),R.add(w,A+2),R.add(k,A+1)}else if(4===v){var y=R.get(A),W=R.get(A+3),q={x:b.x,y:b.y},k=ws(y,q),w=ce(y,q),O=ws(q,W),u=ce(q,W);Y.removeAt(t),Y.add(4,t),Y.add(4,t),R.removeAt(A+1),R.removeAt(A+1),R.add(q,A+1),R.add(u,A+2),R.add(O,A+2),R.add(w,A+1),R.add(k,A+1)}K.s("edge.points",fd(R)),K.s("edge.segments",Y)}}}z&&z.endInteraction()},removeShapePoint:function(r,w){var E=this,A="removeAt",V=E.gv,o=V.dm(),Q=o.getHistoryManager();if(Q&&Q.beginInteraction(),0===arguments.length&&(r=E._shape||E._edge,w=E._removePointIndex),w>=0&&(r instanceof U||r instanceof L)){var P=Kq(r,E.gv.getDataUI(r),w),K=w;if(r instanceof U){var G=r.p(),u=r.toSegments();u||(u=gn(r.getPoints()));var z=u.get(P),Y="removePointAt";if(1===z&&0===K)if(r.getPoints().size()>1){var m=u.get(P+1);u[A](P+1),3===m?r[Y](K+1):4===m&&(r[Y](K+2),r[Y](K+1)),r[Y](K)}else r.dm().remove(r);else 2===z||1===z?(u[A](P),r[Y](K)):3===z?(u[A](P),r[Y](K),r[Y](K-1)):4===z&&(u[A](P),r[Y](K),r[Y](K-1),r[Y](K-2));r.setSegments(u);var i=r.getWidth(),$=r.getHeight(),p=r.p().x-i/2,M=r.p().y-$/2;p-=G.x,M-=G.y;var j=fp(r,{x:p,y:M,width:i,height:$},r.getRotation(),G);r.p(j.x,j.y)}else if(r instanceof L){if("points"!==r.s("edge.type"))return Q&&Q.endInteraction(),void 0;var O=r.s("edge.points");if(u=r.s("edge.segments"),O&&(O=Tj(E.gv.getDataUI(r),O),u||(u=gn(O))),0===w||w===O.size()-1)return Q&&Q.endInteraction(),void 0;u=new l(u._as.slice(0)),O=new l(O._as.slice(0));var z=u.get(P);2===z||1===z?(u[A](P),O[A](K)):3===z?(u[A](P),O[A](K),O[A](K-1)):4===z&&(u[A](P),O[A](K),O[A](K-1),O[A](K-2)),r.s("edge.segments",u),r.s("edge.points",fd(O))}}Q&&Q.endInteraction()},changeShapeSegment:function(M,g,P){var y=this,H=y.gv,T=H.dm(),b=T.getHistoryManager();if(b&&b.beginInteraction(),1!==arguments.length||isNaN(M)||(P=M,M=y._shape||y._edge,g=y._hoverSegmentIndex),M instanceof U||M instanceof L){var D=rb(M,y.gv.getDataUI(M),g);if(!isNaN(g)&&!isNaN(D))if(M instanceof U){var e=M.p(),R=M.toSegments();R||(R=gn(M.getPoints()));var t=R.get(g),X=M.toPoints();if(1===P||2===P)1===t||2===t?R.set(g,P):3===t?(R.set(g,P),X.removeAt(D+1)):4===t&&(R.set(g,P),X.removeAt(D+1),X.removeAt(D+1));else if(3===P){var p=function(){var O=X.get(D),E=X.get(D+1),w=Wl(O,E);R.set(g,3),X.add(w,D+1)};2===t||1===t?p():4===t&&(X.removeAt(D+1),X.removeAt(D+1),p())}else if(4===P){var B=function(){var i=X.get(D),z=X.get(D+1),a=ws(i,z),I=ce(i,z);R.set(g,4),X.add(a,D+1),X.add(I,D+2)};2===t||1===t?B():3===t&&(X.removeAt(D+1),B())}M.setSegments(R),M.setPoints(X);var J=M.getWidth(),S=M.getHeight(),u=M.p().x-J/2,r=M.p().y-S/2;u-=e.x,r-=e.y;var v=new fp(M,{x:u,y:r,width:J,height:S},M.getRotation(),e);M.p(v.x,v.y)}else if(M instanceof L){if("points"!==M.s("edge.type"))return b&&b.endInteraction(),void 0;var X=M.s("edge.points");R=M.s("edge.segments"),X&&(X=Tj(y.gv.getDataUI(M),X),R||(R=gn(X))),R=new l(R._as.slice(0)),X=new l(X._as.slice(0));var t=R.get(g);if(1===P||2===P)1===t||2===t?R.set(g,P):3===t?(R.set(g,P),X.removeAt(D+1)):4===t&&(R.set(g,P),X.removeAt(D+1),X.removeAt(D+1));else if(3===P){var p=function(){var r=X.get(D),L=X.get(D+1),Z=Wl(r,L);R.set(g,3),X.add(Z,D+1)};2===t||1===t?p():4===t&&(X.removeAt(D+1),X.removeAt(D+1),p())}else if(4===P){var B=function(){var b=X.get(D),O=X.get(D+1),h=ws(b,O),p=ce(b,O);R.set(g,4),X.add(h,D+1),X.add(p,D+2)};2===t||1===t?B():3===t&&(X.removeAt(D+1),B())}M.s("edge.points",fd(X)),M.s("edge.segments",R)}}b&&b.endInteraction()},getDefaultSegments:function(M){var C=this.gv,B=C.getDataUI(M);if(M instanceof L){var G=M.s("edge.points");return G=Tj(B,G),gn(G)}if(M instanceof U){var G=M.getPoints(),I=M.getSegments();return I&&I.size()>0?I:gn(G)}},$43l:function(M){var h=this;M&&(h.$5l=1),h._68I=1,h._42()},_42:function(){var m=this;if(m._68I){delete m._68I;var F=m.gv,Y=m.$5l,P=F.getZoom(),$=F.getEditPointSize(),u=$/2,c=new l,g=m._view,_=m._edge,p=m._shape,z=g.getContext("2d"),D=F.tx(),q=F.ty(),d=G,K=F.getEditPointBackground(),e=F.getControlPointBackground(),I=F.getControlPointBorderColor(),Z=F.getEditPointBorderColor(),b=F.getEditRectBorderColor(),Q=F.getDirectionLineColor(),o=F.getSegmentHoverColor(),N=F.getSnapPointBorderColor(),y=F.getJoinPointBackground(),C=F.getJoinPointBorderColor(),H=F.getSegmentHoverWidth(),f=[5,5],R=F.getEditRectBorderStyle();yq(F,function(q){F.isSelected(q)&&F.isVisible(q)&&c.add(q)}),z.clearRect(0,0,x(g.width),x(g.height)),z.save(),J.translateAndScale(z,D,q,1);var t=G,E={x:0,y:0,width:0,height:0},W=0,v=0,r=0,a=0,T=0,s=0,ip=0,cp=0,jg=0,Bd=0,Dn=[];if(Y?(delete m.$6l,delete m.$8l,delete m.$7l,delete m.$16l,delete m.$23l):(t=m.$6l,d=m.$7l),delete m.$68l,delete m.$69l,delete m.$71l,delete m.$70l,delete m.$82l,delete m.$83l,delete m._pointElevationHelperPoint,delete m.$90l,delete m.$91l,delete m.$75l,delete m.$74l,c.each(function(j){var D=F.getDataUI(j);if(D){var m=D._55O;if(F.isEditable(j))m._56O&&j instanceof S&&v++,Dn.push(j),m._42O&&j instanceof S&&W++,F.isHelperEditable(j,"host")&&a++,F.isHelperEditable(j,"parent")&&r++,F.isHelperEditable(j,"remove")&&T++,F.isHelperEditable(j,"edge")&&s++,F.isHelperEditable(j,"source")&&ip++,F.isHelperEditable(j,"target")&&cp++,F.isHelperEditable(j,"elevation")&&jg++,F.isHelperEditable(j,"tall")&&Bd++;else if(j instanceof B&&j.isExpanded()){var c=!0,i=F.getEditableFunc();i&&(c=i(j)),c&&(F.isHelperEditable(j,"host")&&a++,F.isHelperEditable(j,"parent")&&r++,F.isHelperEditable(j,"remove")&&T++,F.isHelperEditable(j,"edge")&&s++,F.isHelperEditable(j,"source")&&ip++,F.isHelperEditable(j,"target")&&cp++,F.isHelperEditable(j,"elevation")&&jg++,F.isHelperEditable(j,"tall")&&Bd++,Dn.push(j))}}}),z.beginPath(),z.lineWidth=1,z.strokeStyle=F.getNodeBorderColor(),Dn.forEach(function(O){var u=F.getDataUI(O),v=u._55O;if(Y)if(d==G&&(d=O instanceof L?0:O instanceof B&&O.isExpanded()?0:O.getRotation(),m.$7l=d),t==G){var D,w,j;if(O instanceof B&&O.isExpanded()||O instanceof L){var l=F.getDataUIBounds(O);w=l.width,j=l.height,D={x:l.x+w/2,y:l.y+j/2}}else D=O.p(),w=O.getWidth(),j=O.getHeight();t={x:D.x,y:D.y,width:0,height:0},E.x=D.x-w/2,E.y=D.y-j/2,E.width=w,E.height=j,t=A(t,E)}else{var D,w,j,U,i=t.x+t.width/2,g=t.y+t.height/2,e={x:i,y:g};if(O instanceof B&&O.isExpanded()||O instanceof L){U=0;var l=F.getDataUIBounds(O);w=l.width,j=l.height,D={x:l.x+w/2,y:l.y+j/2}}else D=O.p(),w=O.getWidth(),j=O.getHeight(),U=O.getRotation();var M={x:D.x-w/2,y:D.y-j/2,width:w,height:j},J={x:M.x,y:M.y},k={x:M.x+M.width,y:M.y},c={x:M.x,y:M.y+M.height},n={x:M.x+M.width,y:M.y+M.height},J=$d(D,J.x-D.x,J.y-D.y,U),c=$d(D,c.x-D.x,c.y-D.y,U),n=$d(D,n.x-D.x,n.y-D.y,U),k=$d(D,k.x-D.x,k.y-D.y,U),b=-d,h=$d(e,J.x-e.x,J.y-e.y,b),T=$d(e,k.x-e.x,k.y-e.y,b),Q=$d(e,c.x-e.x,c.y-e.y,b),R=$d(e,n.x-e.x,n.y-e.y,b),o=V([h,T,Q,R]);t=A(t,o),t.x-=i,t.y-=g;var y=fp(G,t,d,e);t.x=y.x-t.width/2,t.y=y.y-t.height/2}if(W>1&&F.isEditable(O)&&F.isRectEditable(O)&&O instanceof S){var s=O.getRect(),N=v.$45l,$=Rc(N[0],P),H=Rc(N[2],P),C=Rc(N[4],P),K=Rc(N[6],P);O.getRotation()?(z.moveTo($.x,$.y),z.lineTo(H.x,H.y),z.lineTo(C.x,C.y),z.lineTo(K.x,K.y),z.lineTo($.x,$.y)):z.rect(s.x*P,s.y*P,s.width*P,s.height*P)}}),z.stroke(),c.each(function(J){var h=F.getDataUI(J);if(h){var a,M,k=h._55O,Y=h._78o;if(k&&k._43O&&J instanceof U?(a=k.$15l,M=J.getSegments(),M||(M=gn(a)),J.isClosePath()&&M.indexOf(5)<0&&(M=new l(M._as),M.add(5))):k&&Y&&k._43O&&(a=J.s("edge.points"),M=J.s("edge.segments"),a=Tj(h,a),M||(M=gn(a)),a&&(a=a._as)),a&&M){var f=0,W=M.size(),c=m._hoverSegmentIndex;a=a.slice(0);for(var $=0;$<a.length;$++)a[$]=Rc(a[$],P);z.beginPath(),z.strokeStyle=Q,z.lineWidth=1,f=0;for(var $=0;W>$;$++){var g=M.get($);if(1===g||2===g)f++;else if(3===g){var O=a[f-1],E=a[f],D=a[f+1];z.moveTo(O.x,O.y),z.lineTo(E.x,E.y),z.lineTo(D.x,D.y),f+=2}else if(4===g){var O=a[f-1],K=a[f],L=a[f+1],D=a[f+2];z.moveTo(O.x,O.y),z.lineTo(K.x,K.y),z.moveTo(L.x,L.y),z.lineTo(D.x,D.y),f+=3}}if(z.stroke(),p===J||_===J&&"points"===_.s("edge.type")){z.beginPath(),f=0,z.strokeStyle=o,z.lineWidth=H;for(var $=0;W>$;$++){var g=M.get($);if(1===g||2===g){if(c===$){var O=a[f-1],D=a[f];z.moveTo(O.x,O.y),z.lineTo(D.x,D.y);break}f++}else if(3===g){if(c===$){var O=a[f-1],E=a[f],D=a[f+1];z.moveTo(O.x,O.y),z.quadraticCurveTo(E.x,E.y,D.x,D.y);break}f+=2}else if(4===g){if(c===$){var O=a[f-1],K=a[f],L=a[f+1],D=a[f+2];z.moveTo(O.x,O.y),z.bezierCurveTo(K.x,K.y,L.x,L.y,D.x,D.y);break}f+=3}else if(5===g&&c===$){var O=a[f-1],D=a[0];z.moveTo(O.x,O.y),z.lineTo(D.x,D.y);break}}z.stroke()}z.beginPath(),f=0,z.strokeStyle=C,z.lineWidth=1,z.fillStyle=y;for(var $=0;W>$;$++){var g=M.get($);if(1===g||2===g){var D=a[f];z.moveTo(D.x+u,D.y),z.arc(D.x,D.y,u,0,w,!0),f++}else if(3===g){var D=a[f+1];z.moveTo(D.x+u,D.y),z.arc(D.x,D.y,u,0,w,!0),f+=2}else if(4===g){var D=a[f+2];z.moveTo(D.x+u,D.y),z.arc(D.x,D.y,u,0,w,!0),f+=3}}z.fill(),z.stroke(),z.beginPath(),f=0,z.strokeStyle=I,z.lineWidth=1,z.fillStyle=e;for(var $=0;W>$;$++){var g=M.get($);if(1===g||2===g)f++;else if(3===g){var E=a[f];z.moveTo(E.x+u,E.y),z.arc(E.x,E.y,u,0,w,!0),f+=2}else if(4===g){var K=a[f],L=a[f+1];z.moveTo(K.x+u,K.y),z.arc(K.x,K.y,u,0,w,!0),z.moveTo(L.x+u,L.y),z.arc(L.x,L.y,u,0,w,!0),f+=3}}if(z.fill(),z.stroke(),z.beginPath(),f=0,z.strokeStyle=N,z.lineWidth=2,(p===J||_===J)&&m.$9l!=G){var D=a[m.$9l];z.moveTo(D.x+u,D.y),z.arc(D.x,D.y,u,0,w,!0),z.stroke()}}}}),t){m.$6l=M(t),h(t,F.getEditRectPadding()/P);var nb={x:t.x+t.width/2,y:t.y+t.height/2},gs=Ni(nb,t.width,t.height,d),qj=gs[0],Se=gs[1],em=gs[2],jr=gs[3],Td=gs[4],hb=gs[5],Hd=gs[6],ie=gs[7];if(qj=Rc(gs[0],P),Se=Rc(gs[1],P),em=Rc(gs[2],P),jr=Rc(gs[3],P),Td=Rc(gs[4],P),hb=Rc(gs[5],P),Hd=Rc(gs[6],P),ie=Rc(gs[7],P),m.$8l=t,W>0&&(m.$16l=[qj,Td,Se,hb,jr,Hd,em,ie],z.beginPath(),z.lineWidth=1,z.strokeStyle=b,"dashed"===R&&z.setLineDash&&z.setLineDash(f),z.moveTo(qj.x,qj.y),z.lineTo(Se.x,Se.y),z.lineTo(jr.x,jr.y),z.lineTo(em.x,em.y),z.lineTo(qj.x,qj.y),z.stroke(),"dashed"===R&&z.setLineDash&&z.setLineDash([])),z.beginPath(),z.lineWidth=1,z.fillStyle=K,z.strokeStyle=Z,W>0){var Pe=hb.x-ie.x,jl=hb.y-ie.y,oi=n(Pe*Pe+jl*jl),lc=Td.x-Hd.x,zj=Td.y-Hd.y,fk=n(lc*lc+zj*zj),hf=2*$;if(F.isDirectionEditable&&1===Dn.length){var id=Dn[0],Kn=F.getDataUI(id),nf=Kn._55O,Hh=F.isDirectionEditable.bind(F);if(nf._42O){var Dm,zg,co,Mb;Hh(id,"northwest")&&(Dm=!0,z.rect(qj.x-u,qj.y-u,$,$)),Hh(id,"northeast")&&(zg=!0,z.rect(Se.x-u,Se.y-u,$,$)),Hh(id,"southwest")&&(co=!0,z.rect(em.x-u,em.y-u,$,$)),Hh(id,"southeast")&&(Mb=!0,z.rect(jr.x-u,jr.y-u,$,$)),Hh(id,"north")&&(Dm&&zg?oi>hf&&z.rect(Td.x-u,Td.y-u,$,$):z.rect(Td.x-u,Td.y-u,$,$)),Hh(id,"south")&&(Mb&&co?oi>hf&&z.rect(Hd.x-u,Hd.y-u,$,$):z.rect(Hd.x-u,Hd.y-u,$,$)),Hh(id,"west")&&(co&&Dm?fk>hf&&z.rect(ie.x-u,ie.y-u,$,$):z.rect(ie.x-u,ie.y-u,$,$)),Hh(id,"east")&&(Mb&&zg?fk>hf&&z.rect(hb.x-u,hb.y-u,$,$):z.rect(hb.x-u,hb.y-u,$,$))}}else oi>hf&&(z.rect(Td.x-u,Td.y-u,$,$),z.rect(Hd.x-u,Hd.y-u,$,$)),fk>hf&&(z.rect(hb.x-u,hb.y-u,$,$),z.rect(ie.x-u,ie.y-u,$,$)),z.rect(qj.x-u,qj.y-u,$,$),z.rect(Se.x-u,Se.y-u,$,$),z.rect(em.x-u,em.y-u,$,$),z.rect(jr.x-u,jr.y-u,$,$)}if(v>0){var lo=m.$23l=$d(Td,0,2*-$,d);z.moveTo(lo.x+u,lo.y),z.arc(lo.x,lo.y,u,0,w,!1)}z.fill(),z.stroke(),m.$40l&&m.$44l(z,t,d);var Ii,rp,Pn=F.getLeftTopHelpers(),lm=F.getRightTopHelpers(),Sn=F.getLeftBottomHelpers(),Vo=F.getRightBottomHelpers(),Of=F.getEdgeHelpers(),Ko=F.getEditHelperSize(),sr=Ko/2,fg=function(f,N,k,D){"leftTop"===N?(Ii=t.x*P-Ko-u-("h"===D?k*(Ko+u):0)-1,rp=t.y*P-Ko-u-("v"===D?k*(Ko+u):0)-1):"rightTop"===N?(Ii=(t.x+t.width)*P+u+("h"===D?k*(Ko+u):0)+1,rp=t.y*P-Ko-u-("v"===D?k*(Ko+u):0)-1):"leftBottom"===N?(Ii=t.x*P-Ko-u-("h"===D?k*(Ko+u):0)-1,rp=(t.y+t.height)*P+u+("v"===D?k*(Ko+u):0)+1):"rightBottom"===N&&(Ii=(t.x+t.width)*P+u+("h"===D?k*(Ko+u):0)+1,rp=(t.y+t.height)*P+u+("v"===D?k*(Ko+u):0)+1);var H=Ii+sr,n=rp+sr,Z=(t.x+t.width/2)*P,o=(t.y+t.height/2)*P,Q=$d({x:Z,y:o},H-Z,n-o,d);if("host"===f){if(a>0)return m.$77l(z,d,Q),!0}else if("edge"===f){if(s>0)return m.$80l(z,d,Q),!0}else if("remove"===f){if(T>0)return Dn&&1===Dn.length&&Dn[0]instanceof L?m.$81l(z,d,{x:Z+Ko/2+5,y:o}):m.$81l(z,d,Q),!0}else if("parent"===f){if(r>0)return Dn&&1===Dn.length&&Dn[0]instanceof L?m.$76l(z,d,{x:Z-Ko/2-5,y:o}):m.$76l(z,d,Q),!0}else if("elevation"===f){if(jg>0)return m.$85l(z,d,Q),!0}else if("tall"===f){if(Bd>0)return m.$86l(z,d,Q),!0}else if("source"===f||"target"===f){var p=Dn[0],J=F.getDataUI(p),j=fh(J,!0),g=j[0],M=j[1];if(ip&&"source"===f)return m.$84l(z,t,g,!0,p.isLooped(),N,k,D),!0;if(cp&&"target"===f)return m.$84l(z,t,M,!1,p.isLooped(),N,k,D),!0}};if(Pn&&Pn.length>0){var Ve=0;Pn.forEach(function(A){fg(A,"leftTop",Ve,F.getLeftTopHelpersAlign()||"h")&&Ve++})}if(lm&&lm.length>0){var Ve=0;lm.forEach(function(y){fg(y,"rightTop",Ve,F.getRightTopHelpersAlign()||"h")&&Ve++})}if(Sn&&Sn.length>0){var Ve=0;Sn.forEach(function(g){fg(g,"leftBottom",Ve,F.getLeftBottomHelpersAlign()||"h")&&Ve++})}if(Vo&&Vo.length>0){var Ve=0;Vo.forEach(function(o){fg(o,"rightBottom",Ve,F.getRightBottomHelpersAlign()||"h")&&Ve++})}if(Of&&Of.length>0&&((ip||cp)&&Dn&&1===Dn.length&&Dn[0]instanceof L?!0:!1)){var Ve=0;Of.forEach(function(j){fg(j,"edge",Ve,"h")&&Ve++})}if(m.$72l){var Zr,jk=m.$67l,mk=m.$68l,tg=m.$69l,Ad=(m.$71l,m.$70l),tj=m.$82l,ce=m.$83l;if(1===jk?Zr=mk:2===jk?Zr=tg:3===jk?Zr=Ad:5===jk?Zr=tj:6===jk&&(Zr=ce),Zr){var $k=F.lp(m.$72l),ub=F.getDataAt(m.$72l);if(ub&&ub instanceof S){var ls,wr,qd;if(m.$73l=ub,1===jk)if(ub instanceof O.Grid)ls=m.$75l=Sc(ub,$k);else if(ub instanceof O.Shape){qd=m.$74l=_m(ub,$k);var Ne=ub.getPoints();if(qd){var vi=qd.attachIndex,dh=rb(ub,F.getDataUI(ub),vi)+1,_f=dh+1>=Ne.size()?0:dh+1,gd=Ne.get(dh),Ml=Ne.get(_f),Gl=ub.p(),Wk=ub.getRotation();gd=$d(Gl,gd.x-Gl.x,gd.y-Gl.y,Wk),Ml=$d(Gl,Ml.x-Gl.x,Ml.y-Gl.y,Wk),z.beginPath(),z.strokeStyle=o,z.lineWidth=H,z.moveTo(gd.x*P,gd.y*P),z.lineTo(Ml.x*P,Ml.y*P),z.stroke()}}ls?wr=ls.rect:(wr=j.clone(F.getDataUIBounds(ub)),j.grow(wr,2)),z.beginPath(),z.rect(wr.x*P,wr.y*P,wr.width*P,wr.height*P),z.strokeStyle=1===jk||4===jk||6===jk?i:k,z.lineWidth=2,z.setLineDash&&z.setLineDash([8,8]),z.stroke()}else delete m.$73l;$k.x=$k.x*P,$k.y=$k.y*P;var xk=lk(Zr.x,Zr.y,$k.x,$k.y),Ke=$d(Zr,$k.x-Zr.x,$k.y-Zr.y,-xk),Xq=Ke.x-Zr.x;z.translate(Zr.x,Zr.y),z.rotate(xk),X.width=Xq,X.height=40;var sh=k;(1===jk||4===jk||6===jk)&&(sh=i),X.comps[0].gradientColor=sh,j.drawImage(z,X,0,-20,Xq,40)}}}if(m.$87l&&F.sm().contains(m.$87l)){var Gg,Io=m.$87l,pc=m.$88l,Ko=F.getEditHelperSize(),sr=Ko/2;if(F.isHelperEditable(Io,"pointElevation"))if(Io instanceof U){var Gk=Io.getPosition();Gg=j.clone(Io.getPoints().get(pc)),Gg=$d({x:Gk.x,y:Gk.y},Gg.x-Gk.x,Gg.y-Gk.y,Io.getRotation()),Gg.x*=P,Gg.y*=P,z.translate(Gg.x,Gg.y),j.drawImage(z,Re,sr,-sr,Ko,Ko),z.translate(-Gg.x,-Gg.y),m._pointElevationHelperPoint={x:Gg.x+Ko,y:Gg.y}}else if(Io instanceof L){var Qb=Tj(F.getDataUI(Io),Io.s("edge.points")),Gg=j.clone(Qb.get(pc));Gg.x*=P,Gg.y*=P,z.translate(Gg.x,Gg.y),j.drawImage(z,Re,sr,-sr,Ko,Ko),z.translate(-Gg.x,-Gg.y),m._pointElevationHelperPoint={x:Gg.x+Ko,y:Gg.y}}}z.restore(),m.$5l=0}},$89l:function(m,q,E,Q){m.save();var X=this,x=X.gv,z=x.getEditHelperSize(),S=z/2;m.beginPath(),m.translate(E.x,E.y),m.rotate(q),j.drawImage(m,Q,-S,-S,z,z),m.restore()},$85l:function(o,T,m){var c=this;c.$90l=m,c.$89l(o,T,m,Re)},$86l:function(g,F,_){var A=this;A.$91l=_,A.$89l(g,F,_,tk)},$77l:function(L,n,t){var A=this;A.$68l=t,A.$89l(L,n,t,z)},$80l:function(g,z,I){var u=this;u.$70l=I,u.$89l(g,z,I,$)},$81l:function(c,$,U){var Z=this;Z.$71l=U,Z.$89l(c,$,U,xn)},$76l:function(U,j,t){var _=this;_.$69l=t,_.$89l(U,j,t,Q)},$84l:function(b,r,n,I,f){var T,R=this,L=R.gv,Y=L.getZoom(),S=L.getEditHelperSize(),l=S/2;n.x*=Y,n.y*=Y,f&&(I?n.x-=l+5:n.x+=l+5),n.y-=S-2,I?(R.$82l=n,T=jj):(R.$83l=n,T=Nm),b.beginPath(),b.translate(n.x,n.y),j.drawImage(b,T,-l,-l,S,S),b.translate(-n.x,-n.y)},$44l:function(o,B,A){o.save();var w=this.gv.getZoom(),u=n(a(B.width,2)+a(B.height,2))/2*w+10,t=u,f=t+8,h=t+18,g=A,z=B.x+B.width/2,R=B.y+B.height/2;o.translate(z*w,R*w),o.beginPath(),o.strokeStyle="rgb(150, 150, 150)";for(var O=0,V=0,b=0,_=0,Q=0,d=0;360>d;d++)O=d*I/180,0===d%5&&(V=r(O)*t,b=Z(O)*t,_=r(O)*f,Q=Z(O)*f,o.moveTo(V,b),o.lineTo(_,Q)),0===d%45&&(V=r(O)*t,b=Z(O)*t,_=r(O)*h,Q=Z(O)*h,o.moveTo(V,b),o.lineTo(_,Q));o.stroke(),o.beginPath(),o.rotate(-D),o.beginPath(),o.fillStyle="rgba(255, 0, 0, 0.1)",o.strokeStyle="rgb(157, 157, 157)",o.moveTo(0,0),o.arc(0,0,h,0,A,!1),o.fill(),o.beginPath(),o.moveTo(0+h,0),o.arc(0,0,h,0,A,!1),o.stroke(),o.rotate(D),o.font="bold 12px Verdana, Arial";var m=20*Z(g),j=20*r(g),k=K(180*g/I)+"°";o.textAlign="center",o.textBaseline="middle",o.beginPath();var v=o.measureText("365.°").width;o.fillStyle="white",o.rect(m-v/2,-j-10,v,20),o.fill(),o.beginPath(),o.fillStyle="rgb(79,79,79)",o.fillText(k,m,-j),o.restore()}})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:this,Object);