!function(s,d){"use strict";var r="ht",C=r+".layout.",t=s[r]||module.parent.exports.ht,n=t.List,_=t.DataModel,e=t.Node,B=t.Edge,S=t.Group,z=Math,v=z.sqrt,f=z.random,H=z.max,X=z.min,Q=function(C){return C*C};t.Default.getInternal().addMSMap({ms_force:function(j){j._interval=50,j._stepCount=10,j._motionLimit=.01,j._edgeRepulsion=.65,j._nodeRepulsion=.65,j._damper=1,j._maxMotion=0,j._motionRatio=0,j.init=function(C){var r=this;C instanceof _?r.dm=C:r.gv=C,r._nodeMap={},r._nodes=new n,r._edges=new n},j.start=function(){var d=this,p=d.gv;if(!d._timer){var B=d.cdm=p?p.dm():d.dm;B.mm(d.handleDataModelChange,d),B.md(d.handleDataPropertyChange,d),p&&p.mp(d.handleGV,d),B.each(function(c){if(d.isVisible(c)&&d.isLayoutable(c)&&c instanceof e)if(d instanceof q){var D=c.p3();c.p3([D[0]+f(),D[1]+f(),D[2]+f()])}else D=c.p(),c.p(D.x+f(),D.y+f())}),d._timer=setInterval(function(){d.relax()},d._interval),d._damper=1}},j.stop=function(){var c=this;c._timer&&(c.cdm.umm(c.handleDataModelChange,c),c.cdm.umd(c.handleDataPropertyChange,c),c.gv&&c.gv.ump(c.handleGV,c),clearInterval(c._timer),delete c._timer,delete c.cdm)},j.handleGV=function(Z){var T=this;if("dataModel"===Z.property){var L=Z.oldValue,C=Z.newValue;L&&(L.umm(T.handleDataModelChange,T),L.umd(T.handleDataPropertyChange,T)),this.cdm=C,C.mm(T.handleDataModelChange,T),C.md(T.handleDataPropertyChange,T)}},j.relax=function(){var K=this;if(!(K._damper<.1&&K._maxMotion<K._motionLimit)){this.cdm.each(function(I){K.isVisible(I)&&(I instanceof B?K.addEdge(I):I instanceof e&&K.addNode(I))});for(var x,A,w=0,m=K._edges,r=K._nodes,d=r.size();w<K._stepCount;w++){for(m.each(K.relaxEdge,K),x=0;d>x;x++)for(A=0;d>A;A++)K.relaxNode(r.get(x),r.get(A));K.moveNode()}K._isAdjusting=1,r.each(function(x){x.fix||(x.p?x.v.p3(x.p):x.v.p(x.x,x.y))}),delete K._isAdjusting,K._nodeMap={},r.clear(),m.clear(),K.onRelaxed()}},j.onRelaxed=function(){},j.isRunning=function(){return!!this._timer},j.isVisible=function(F){return F.s("layoutable")===!1?!1:this.gv?this.gv.isVisible(F):!0},j.isLayoutable=function(D){if(D.s("layoutable")===!1)return!1;if(D instanceof S)return!1;var q=this;return q.gv?q.gv.isMovable(D)&&!q.gv.isSelected(D):!(q.cdm||q.dm).sm().co(D)},j.getNodeRepulsion=function(){return this._nodeRepulsion},j.setNodeRepulsion=function(l){this._nodeRepulsion=l,this._damper=1},j.getEdgeRepulsion=function(){return this._edgeRepulsion},j.setEdgeRepulsion=function(u){this._edgeRepulsion=u,this._damper=1},j.getStepCount=function(){return this._stepCount},j.setStepCount=function(N){this._stepCount=N,this._damper=1},j.getInterval=function(){return this._interval},j.setInterval=function(y){var n=this;n._interval!==y&&(n._interval=y,n._timer&&(clearInterval(n._timer),n._timer=setInterval(function(){n.relax()},y)))},j.handleDataPropertyChange=function(V){!this._isAdjusting&&this.isVisible(V.data)&&(this._damper=1)},j.handleDataModelChange=function(){this._damper=1},j.damp=function(){var u=this._maxMotion,A=this._damper;this._motionRatio<=.001&&((.2>u||u>1&&.9>A)&&A>.01?this._damper-=.01:.4>u&&A>.003?this._damper-=.003:A>1e-4&&(this._damper-=1e-4)),u<this._motionLimit&&(this._damper=0)}}}),t.layout.ForceLayout=function(p){this.init(p)},t.Default.def(C+"ForceLayout",d,{ms_force:1,getLimitBounds:function(){return this._limitBounds},setLimitBounds:function(E){this._limitBounds=E,this._damper=1},getNodeSize:function(A){var h=this.gv;return h&&h.getDataUIBounds?h.getDataUIBounds(A):A.getRect()},addNode:function(I){var J=this,A=J._nodeMap[I._id];if(A)return A;var S=I.p();A={v:I,x:S.x,y:S.y,dx:0,dy:0,fix:!J.isLayoutable(I),s:J.getNodeSize(I)};var p=A.s,G=v(Q(p.width)+Q(p.height))*J._nodeRepulsion;return A.r=1>G?100:G,J._nodeMap[I._id]=A,J._nodes.add(A),A},addEdge:function(S){if(S._40I&&S._41I){var y=this,q=y.addNode(S._40I),t=y.addNode(S._41I),I={s:q,t:t};t=t.s,q=q.s;var R=t.width+q.width,Q=t.height+q.height;I.length=v(R*R+Q*Q)*y._edgeRepulsion,I.length<=0&&(I.length=100),y._edges.add(I)}},relaxEdge:function(u){var Z=u.t,C=u.s,j=Z.x-C.x,F=Z.y-C.y,T=v(j*j+F*F),a=100*u.length,S=.25*j/a*T,e=.25*F/a*T;Z.dx=Z.dx-S,Z.dy=Z.dy-e,C.dx=C.dx+S,C.dy=C.dy+e},relaxNode:function(l,U){if(l!==U){var I=0,Y=0,q=l.x-U.x,x=l.y-U.y,K=q*q+x*x;0===K?(I=f(),Y=f()):36e4>K&&(I=q/K,Y=x/K);var H=l.r*U.r/400;I*=H,Y*=H,l.dx+=I,l.dy+=Y,U.dx-=I,U.dy-=Y}},moveNode:function(){var z=this,S=z._limitBounds,C=z._maxMotion,c=0,u=z._damper;z._nodes.each(function(B){if(!B.fix){var Q=B.dx*u,T=B.dy*u;if(B.dx=Q/2,B.dy=T/2,c=H(v(Q*Q+T*T),c),B.x+=H(-40,X(40,Q)),B.y+=H(-40,X(40,T)),S){B.x<S.x&&(B.x=S.x,z.adjust(1,0)),B.y<S.y&&(B.y=S.y,z.adjust(0,1));var Z=B.s;B.x+Z.width>S.x+S.width&&(B.x=S.x+S.width-Z.width,z.adjust(-1,0)),B.y+Z.height>S.y+S.height&&(B.y=S.y+S.height-Z.height,z.adjust(0,-1))}}}),z._maxMotion=c,z._motionRatio=c>0?C/c-1:0,z.damp()},adjust:function(W,A){var H=this._limitBounds;this._nodes.each(function(o){W>0?(!H||o.x+o.s.width+W<H.x+H.width)&&(o.x+=W):(!H||o.x+W>H.x)&&(o.x+=W),A>0?(!H||o.y+o.s.height+A<H.y+H.height)&&(o.y+=A):(!H||o.y+A>H.y)&&(o.y+=A)})}});var q=t.layout.Force3dLayout=function(O){this.init(O)};t.Default.def(C+"Force3dLayout",d,{ms_force:1,getNodeSize3d:function(f){return f.s3()},addNode:function(y){var O=this,s=O._nodeMap[y._id];if(s)return s;s={v:y,p:y.p3(),d:[0,0,0],fix:!O.isLayoutable(y),s:O.getNodeSize3d(y)};var L=s.s,K=t.Default.getDistance(L)*O._nodeRepulsion;return s.r=1>K?100:K,O._nodeMap[y._id]=s,O._nodes.add(s),s},addEdge:function(u){if(u._40I&&u._41I){var e=this,F=e.addNode(u._40I),N=e.addNode(u._41I),V={s:F,t:N};N=N.s,F=F.s,V.length=v(Q(N[0]+F[0])+Q(N[1]+F[1])+Q(N[2]+F[2]))*e._edgeRepulsion,V.length<=0&&(V.length=100),e._edges.add(V)}},relaxEdge:function(u){var y=u.t.p,P=u.s.p,m=u.t.d,D=u.s.d,N=y[0]-P[0],M=y[1]-P[1],E=y[2]-P[2],z=v(N*N+M*M+E*E),r=100*u.length,b=.25*N/r*z,f=.25*M/r*z,C=.25*E/r*z;m[0]-=b,m[1]-=f,m[2]-=C,D[0]+=b,D[1]+=f,D[2]+=C},relaxNode:function(N,Q){if(N!==Q){var M=N.p,K=Q.p,U=0,Z=0,t=0,h=M[0]-K[0],o=M[1]-K[1],C=M[2]-K[2],m=h*h+o*o+C*C;0===m?(U=f(),Z=f(),t=f()):216e6>m&&(U=h/m,Z=o/m,t=C/m);var P=N.r*Q.r/400,B=N.d,n=Q.d;U*=P,Z*=P,t*=P,B[0]+=U,B[1]+=Z,B[2]+=t,n[0]-=U,n[1]-=Z,n[2]-=t}},moveNode:function(){var b=this,B=b._maxMotion,y=0,k=b._damper;b._nodes.each(function(g){if(!g.fix){var p=g.p,r=g.d,V=r[0]*k,P=r[1]*k,G=r[2]*k;r[0]=V/2,r[1]=P/2,r[2]=G/2,y=H(v(V*V+P*P+G*G),y),p[0]+=H(-40,X(40,V)),p[1]+=H(-40,X(40,P)),p[2]+=H(-40,X(40,G))}}),b._maxMotion=y,b._motionRatio=y>0?B/y-1:0,b.damp()}})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:this,Object);