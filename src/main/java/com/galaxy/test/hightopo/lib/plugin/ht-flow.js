!function(h){"use strict";var f="ht",X=h[f],Z=X.Default,r=Math,s=r.PI,x=2*s,j=r.sin,G=r.cos,S=r.atan2,J=r.sqrt,U=r.max,Q=r.floor,k=(r.round,r.ceil),t=r.abs,F=X.Shape,D=X.Edge,m=X.List,w=X.Style,C=X.graph,$=Z.getInternal(),p=$.ui(),o=null,L="__segmentLengths",P="__lineTotalLength",_="__linePoints",W="__distance0",i="flow.count",T="flow.step",c="flow.element.max",e="flow.element.count",N="flow.element.min",R="flow.element.space",g="flow.element.autorotate",E="flow.element.background",M="flow.element.shadow.max",K="flow.element.shadow.min",I="flow.element.shadow.begincolor",H="flow.element.shadow.endcolor",O="flow.element.shadow.visible",z="flow.element.image",V="flow",d="prototype",n=C.GraphView[d],u=X.Data[d],B=p.DataUI[d],b=p.ShapeUI[d],v=p.EdgeUI[d],A=X.DataModel[d],l=b._80o,q=v._80o,a=A.prepareRemove,Y=v._79o,y=b._79o,Vk=n.setDataModel,gl=function(j){return document.createElement(j)};n.calculatePointLength=function(Q,n,B){var N=this,i=N.getDataUI(Q);B==o&&(B=.1);var s=Nk(i),M=[];if(s){for(var y=s.length,U=0;y>U;U++){var P=s[U];P._as&&(P=P._as);for(var X=P[0],K=1;K<P.length;K++)M.push([X,P[K]]),X=P[K]}for(var v=[],U=0;U<M.length;U++){var O=Wn(M[U][0],M[U][1],n);v.push(O)}var g=v.slice(0);g.sort(function(w,g){return w.z>g.z?1:w.z<g.z?-1:0});var A=g[0];if(A.z<B){for(var G=v.indexOf(A),C=0,U=0;G>=U;U++)C+=G>U?Z.getDistance(M[U][0],M[U][1]):Z.getDistance(M[U][0],A);return C}}},Z.calculatePointLength=function(B,a,S,W){W==o&&(W=.1);var P=Nk(o,B,a),a=[];if(P){for(var I=P.length,$=0;I>$;$++){var f=P[$];f._as&&(f=f._as);for(var k=f[0],R=1;R<f.length;R++)a.push([k,f[R]]),k=f[R]}for(var x=[],$=0;$<a.length;$++){var X=Wn(a[$][0],a[$][1],S);x.push(X)}var p=x.slice(0);p.sort(function(m,R){return m.z>R.z?1:m.z<R.z?-1:0});var y=p[0];if(y.z<W){for(var Q=x.indexOf(y),m=0,$=0;Q>=$;$++)m+=Q>$?Z.getDistance(a[$][0],a[$][1]):Z.getDistance(a[$][0],y);return m}}},n.calculateClosestPoint=function(c,B){var q=this,z=q.getDataUI(c),W=Nk(z),Q=[];if(W){for(var X=W.length,H=0;X>H;H++){var v=W[H];v._as&&(v=v._as);for(var I=v[0],M=1;M<v.length;M++)Q.push([I,v[M]]),I=v[M]}for(var D=[],H=0;H<Q.length;H++){var Y=Wn(Q[H][0],Q[H][1],B);D.push(Y)}return D.sort(function(f,v){return f.z>v.z?1:f.z<v.z?-1:0}),D[0]}},Z.calculateClosestPoint=function(W,A,H){var x=Nk(o,W,A),A=[];if(x){for(var L=x.length,b=0;L>b;b++){var f=x[b];f._as&&(f=f._as);for(var E=f[0],V=1;V<f.length;V++)A.push([E,f[V]]),E=f[V]}for(var U=[],b=0;b<A.length;b++){var S=Wn(A[b][0],A[b][1],H);U.push(S)}return U.sort(function(X,N){return X.z>N.z?1:X.z<N.z?-1:0}),U[0]}},n.getPercentAngle=function(N,w){var d=this,m=d.getDataUI(N),c=N.getRotation?N.getRotation():0,g=Nk(m);if(g)if(0===w){var t=g[0][0],a=g[0][1];c+=S(a.y-t.y,a.x-t.x)}else if(100===w){g=g[g.length-1];var t=g[g.length-2],a=g[g.length-1];c+=S(a.y-t.y,a.x-t.x)}else{for(var R=0,h=[],K=g.length,o=0;K>o;o++){var F=g[o],M=cd(F);R+=M,h.push(M)}for(var T=R*w/100,p=Km(T,h),j=0,V=0;p>V;V++)j+=h[V];T-=j;for(var l=Kp(g[p],T),Q=g[p],E=0,G=0,B=0;B<Q.length-1;B++){var z=Q[B],k=Q[B+1],X=k.x-z.x,i=k.y-z.y,Y=J(X*X+i*i);if(E+=Y,E>T){G=B;break}}var C=Q[G];c+=S(l.y-C.y,l.x-C.x)}return c},Z.getPercentAngle=function(q,r,T){var K=0,C=Nk(o,q,r);if(C)if(0===T){var b=C[0][0],F=C[0][1];K+=S(F.y-b.y,F.x-b.x)}else if(100===T){C=C[C.length-1];var b=C[C.length-2],F=C[C.length-1];K+=S(F.y-b.y,F.x-b.x)}else{for(var W=0,v=[],u=C.length,Q=0;u>Q;Q++){var t=C[Q],e=cd(t);W+=e,v.push(e)}for(var d=W*T/100,N=Km(d,v),V=0,h=0;N>h;h++)V+=v[h];d-=V;for(var x=Kp(C[N],d),P=C[N],Y=0,X=0,n=0;n<P.length-1;n++){var Z=P[n],D=P[n+1],p=D.x-Z.x,i=D.y-Z.y,I=J(p*p+i*i);if(Y+=I,Y>d){X=n;break}}var s=P[X];K+=S(x.y-s.y,x.x-s.x)}return K},n.calculateLength=function(L){var y=this,C=y.getDataUI(L),T=Nk(C),x=0;if(T)if(Array.isArray(T[0]))for(var k=T.length,M=0;k>M;M++){var G=T[M],R=cd(G);x+=R}else x=cd(T);return x},Z.calculateLength=function(c,s){var c=Nk(o,c,s),H=0;if(c)if(Array.isArray(c[0]))for(var E=c.length,Q=0;E>Q;Q++){var j=c[Q],r=cd(j);H+=r}else H=cd(c);return H};var Wn=Z.calculateClosestPointOnLine=function(s,O,e){var Z=s.x,G=s.y,k=O.x,u=O.y,S=e.x,q=e.y,K={},V=k-Z,m=u-G,Y=Math.sqrt(V*V+m*m),i=V/Y,C=m/Y,p=(-Z+S)*i+(-G+q)*C;return K.x=Z+p*i,K.y=G+p*C,sp(K,s,O)||(K.x=Math.abs(K.x-s.x)<Math.abs(K.x-O.x)?s.x:O.x,K.y=Math.abs(K.y-s.y)<Math.abs(K.y-O.y)?s.y:O.y),V=S-K.x,m=q-K.y,K.z=Math.sqrt(V*V+m*m),K},sp=function(P,l,g){return P.x>=Math.min(l.x,g.x)&&P.x<=Math.max(l.x,g.x)&&P.y>=Math.min(l.y,g.y)&&P.y<=Math.max(l.y,g.y)},cd=function(F){for(var N=0,T=F.length-1,p=0;T>p;p++){var H=F[p],f=F[p+1],A=f.x-H.x,E=f.y-H.y,g=J(A*A+E*E);N+=g}return N},Kp=function(P,F){for(var w=0,Q=0,a=0,o=P.length-1,z=0;o>z;z++){var N=P[z],X=P[z+1],A=X.x-N.x,T=X.y-N.y;if(a=J(A*A+T*T),w+=a,w>F){w-=a,Q=z;break}}var C=P[Q],y=P[Q+1],W=S(y.y-C.y,y.x-C.x),H=F-w,T=j(W)*H,A=G(W)*H;return{x:C.x+A,y:C.y+T}},cc=function(w,R,t,s){var g=G(s),U=j(s),k=g*R-U*t,F=U*R+g*t;return w?{x:w.x+k,y:w.y+F}:{x:k,y:F}},tn=function(n,M){n[L]=n[P]=n[_]=M[W]=o},Mh=function(w,F,L,m,I,p){var M,Y,X,H,E,O,d,J,$,P,y,B=[];if(t(m)>x&&(m=x),E=k(t(m)/(s/4)),M=m/E,Y=-M,X=-L,E>0){O=w+G(L)*I,d=F+j(-L)*p,B.push({x:O,y:d});for(var z=0;E>z;z++)X+=Y,H=X-Y/2,J=w+G(X)*I,$=F+j(X)*p,P=w+G(H)*(I/G(Y/2)),y=F+j(H)*(p/G(Y/2)),B.push({x:P,y:y}),B.push({x:J,y:$})}return B},Nk=function(y,k,Z){if(k==o){var S=y._data;if(S instanceof F){if(k=S.getPoints(),Z=S.getSegments(),(!Z||0===Z.size())&&k){Z=new X.List([1]);for(var c=1;c<k.size();c++)Z.add(2)}}else if(S instanceof D){var j=y._78o;if(j){var T=j.type,N=j.points,V=j.segments,R=j._4O;if(!T||N){var p=j._69o,U=p.x,z=p.y,d=j._70o,t=d.x,q=d.y;if(T)V?(k=new m({x:U,y:z}),k.addAll(N),k.add({x:t,y:q}),Z=new m(V._as)):(k=new m({x:U,y:z}),Z=new m([1]),N.each(function(H){k.add(H),Z.add(2)}),k.add({x:t,y:q}),Z.add(2));else if(j.looped){k=new m(Mh(U,z,0,x,j.radius,j.radius)),Z=new m([1]);for(var c=0;c<(k.size()-1)/2;c++)Z.add(3)}else k=new m,j.center?(k.add({x:j.c1.x,y:j.c1.y}),k.add({x:U,y:z}),k.add({x:t,y:q}),k.add({x:j.c2.x,y:j.c2.y}),Z=new m([1,2,2,2])):(k.add({x:U,y:z}),k.add({x:t,y:q}),Z=new m([1,2]))}else if(R)if(k=new m(R.points._as),R.segments)Z=new m(R.segments._as);else{Z=new m([1]);for(var c=1;c<R.points.size();c++)Z.add(2)}}}}if(k){if(Array.isArray(k)&&(k=new m(k)),"number"==typeof k.get(0)){for(var K=new X.List,c=0;c<k.size();c+=2)K.add({x:k.get(c),y:k.get(c+1)});k=K}if(!Z){Z=[];for(var c=0;c<k.size();c++)0===c?Z.push(1):Z.push(2)}Array.isArray(Z)&&(Z=new m(Z));for(var O=$.toPointsArray(k._as,Z._as,50),W=O.length,a=[],c=0;W>c;c++){var i=O[c];i.length>1&&a.push(i)}return a}},zd=function(e){var R=e._data,g=Nk(e);if(g){R.s("flow.reverse")&&(g.reverse(),g.forEach(function(d){d.reverse()}));for(var N=0,x=[],y=g.length,U=0;y>U;U++){var v=g[U],O=cd(v);N+=O,x.push(O)}if(R[L]=x,R[P]=N,R[_]=g,R instanceof D){var o=Z.unionPoint(g),j=o.x+o.width/2,C=o.y+o.height/2;R.$10e={x:j,y:C}}gj(e,!0)}},gj=(Z.getPercentPositionOnPoints=function(J,F,m){if(J){var G=Nk(o,J,F);if(G){var Q;if(0===m)Q=G[0][0];else if(100===m)G=G[G.length-1],Q=G[G.length-1];else{for(var j=0,W=[],X=G.length,Y=0;X>Y;Y++){var E=G[Y],h=cd(E);j+=h,W.push(h)}for(var i=j*m/100,I=Km(i,W),Z=0,P=0;I>P;P++)Z+=W[P];i-=Z,Q=Kp(G[I],i)}return Q}}},n.getPercentPosition=function(S,R){var Q=this,f=Q.getDataUI(S),F=Nk(f);if(F){var E;if(0===R)E=F[0][0];else if(100===R)F=F[F.length-1],E=F[F.length-1];else{for(var Z=0,n=[],c=F.length,o=0;c>o;o++){var H=F[o],C=cd(H);Z+=C,n.push(C)}for(var p=Z*R/100,D=Km(p,n),l=0,A=0;D>A;A++)l+=n[A];p-=l,E=Kp(F[D],p)}return E}},function(f,M){var U=f._data,Q=U[P],m=U.s(i),J=U.s(T),u=0,v=U[L],z=U.s(c),h=U.s(N),o=U.s(e),l=(z-h)/(o-1),I=[];if(v){if(1===o)I.push(z);else if(2===o)I.push(z),I.push(h);else{if(!(o>2))return;I.push(z);for(var n=o-2;n>0;n--)I.push(h+l*n);I.push(h)}var O=0,r=0;I.forEach(function(A){o-1>O&&(r+=U.getFlowElementSpace(A)),O++}),r+=(z+h)/2,u=(Q-m*r+r)/m;var G=f[W];for(null==G&&(G=0),M||(G+=J);G>Q+r;){var Y=f._overCount;Y?Y++:Y=1,Y>=m&&(Y=null),f._overCount=Y,U.s("flow.autoreverse")?Y?G-=u+r:(G=0,U.s("flow.reverse",!U.s("flow.reverse"))):G-=u+r}f[W]=G}}),om=function(t){var Z=t.data,_=this.dm();if(Z&&"add"===t.kind){var z=_.$3e;z&&Z.s(V)&&z.indexOf(Z)<0&&z.push(Z)}"clear"===t.kind&&(_.$3e=[])},im=function(L){var E=L.property,i=L.data,X=L.newValue,T=this.dm().$3e;if(T&&"s:flow"===E)if(X)T.indexOf(i)<0&&T.push(i);else for(var D=T.length,W=0;D>W;W++)if(T[W]===i){T.splice(W,1);break}},Km=Km=function(n,q){for(var v=0,b=q.length,Z=0;b>Z;Z++){var l=q[Z];if(v+=l,v>n)return Z}return Z},Zf=function(F){var w=this,m=w._data,s=m[P],f=m[L],O=m[_],A=m.s(i),Q=0,n=w[W],z=m.s(c),v=m.s(N),b=m.s(e),U=m.s(K),Z=m.s(M),E=m.s(g),T=(Z-U)/(b-1),X=(z-v)/(b-1),r=m.getRotation?m.getRotation():0,y=m.getPosition?m.p():m.$10e,B=[],V=[];if(n!=o){if(1===b)B.push(z);else if(2===b)B.push(z),B.push(v);else{if(!(b>2))return;B.push(z);for(var D=b-2;D>0;D--)B.push(v+X*D);B.push(v)}if(1===b)V.push(Z);else if(2===b)V.push(Z),V.push(U);else{if(!(b>2))return;V.push(Z);for(var D=b-2;D>0;D--)V.push(U+T*D);V.push(U)}var h=0,x=0;B.forEach(function(d){b-1>h&&(x+=m.getFlowElementSpace(d)),h++}),x+=(z+v)/2,Q=(s-A*x+x)/A,F.save();for(var D=0;A>D;D++){var t=n,H=0,G=w._overCount,R=0;m.s("flow.autoreverse")&&G&&G>A-(D+1)||(t-=D*(Q+x),h=0,B.forEach(function(G){var A=t-H;if(A>=0&&s>A){var q=!0,Z=Km(A,f);R=0;for(var n=0;Z>n;n++)R+=f[n];if(A-=R,q){var U=Kp(O[Z],A),x=r;if(E){for(var b=O[Z],z=0,j=0,K=0;K<b.length-1;K++){var D=b[K],T=b[K+1],k=T.x-D.x,M=T.y-D.y,X=J(k*k+M*M);if(z+=X,z>A){j=K;break}}var Q=b[j];x+=S(U.y-Q.y,U.x-Q.x)}r&&(U=cc(y,U.x-y.x,U.y-y.y,r)),w.$5e(F,U,G,V[h],x)}}H+=m.getFlowElementSpace(B[h]),h++}))}F.restore()}},Xd=function(){var F=this,r=F._data,z=r.s(c),g=!1,t=o;if(F._6I||(g=!0),t=r instanceof D?Y.call(F):y.call(F),r.s(V)&&g){var n=r.s(M),$=r.s(O);$&&n>z&&(z=n),z>0&&Z.grow(t,k(z/2)),zd(F)}return!r.s(V)&&g&&tn(r,F),t};u.getFlowElementSpace=function(){return this.s(R)},b._79o=Xd,v._79o=Xd,w[c]==o&&(w[c]=7),w[N]==o&&(w[N]=0),w[i]==o&&(w[i]=1),w[T]==o&&(w[T]=3),w[e]==o&&(w[e]=10),w[R]==o&&(w[R]=3.5),w[g]==o&&(w[g]=!1),w[E]==o&&(w[E]="rgba(255, 255, 114, 0.4)"),w[I]==o&&(w[I]="rgba(255, 255, 0, 0.3)"),w[H]==o&&(w[H]="rgba(255, 255, 0, 0)"),w[O]==o&&(w[O]=1),w[M]==o&&(w[M]=22),w[K]==o&&(w[K]=4),A.prepareRemove=function(l){a.call(this,l);var K=l._dataModel,Y=K.$3e;if(Y)for(var $=Y.length,y=0;$>y;y++)if(Y[y]===l){Y.splice(y,1);break}},n.setDataModel=function(Z){var _=this,o=_._dataModel;if(o!==Z){o&&(o.umm(om,_),o.umd(im,_),o.$3e=[]),Z.mm(om,_),Z.md(im,_);var n=Z.$3e=[];Z.each(function(L){L.s(V)&&n.indexOf(L)<0&&n.push(L)}),Vk.call(_,Z)}},n.setFlowInterval=function(N){var X=this,i=X.$11e;X.$11e=N,X.fp("flowInterval",i,N),X.$7e!=o&&(clearInterval(X.$7e),delete X.$7e,X.enableFlow(N))},n.getFlowInterval=function(){return this.$11e},n.$9e=function(){var q,o,I,j=this,g=j.tx(),z=j.ty(),n=j.getZoom(),S=j.getWidth(),i=j.getHeight(),L={x:-g/n,y:-z/n,width:S/n,height:i/n},u=j.dm().$3e,v=j._56I,H=new m;if(u.forEach(function(N){v[N.getId()]&&(q=j.getDataUI(N),q&&(I=q._79o(),I&&H.add(I)))}),0!==H.size()&&(H.each(function(w){Z.intersectsRect(L,w)&&(o=Z.unionRect(o,w))}),o&&(o&&(Z.grow(o,U(1,1/n)),o.x=Q(o.x*n)/n,o.y=Q(o.y*n)/n,o.width=k(o.width*n)/n,o.height=k(o.height*n)/n,o=Z.intersection(L,o)),o))){var r=j._canvas.getContext("2d");r.save(),r.lineCap=Z.lineCap,r.lineJoin=Z.lineJoin,$.translateAndScale(r,g,z,n),r.beginPath(),r.rect(o.x,o.y,o.width,o.height),r.clip(),r.clearRect(o.x,o.y,o.width,o.height),j.$6e(r,o),r.restore()}},n.$6e=function(A,K){var j,J,T=this;T._93db(A),T.each(function(k){T._56I[k._id]&&(j=T.getDataUI(k),j&&(J=j._79o(),(!K||Z.intersectsRect(K,J))&&j._42(A)))}),T._92db(A)},n.enableFlow=function(J){var X=this,Q=X.dm(),Z=Q.$3e;X.$7e==o&&(Z.forEach(function(G){var m=X.getDataUI(G);zd(m)}),X.$7e=setInterval(function(){Q.$3e.forEach(function(e){gj(X.getDataUI(e))}),X.$9e()},J||X.$11e||50))},n.disableFlow=function(){var x=this;clearInterval(x.$7e),delete x.$7e;var M=x.dm().$3e;M&&x.$9e()},B.$5e=function(Y,t,f,d,_){var M=this,A=M._data,k=M.gv,K=A.s(E),j=A.s(I),i=A.s(H),r=A.s(O),G=k.$8e,g=A.s(z);if(G==o&&(G=k.$8e={}),Y.beginPath(),g!=o){var J=Z.getImage(g),S=f/2;Y.translate(t.x,t.y),Y.rotate(_),Y.translate(-t.x,-t.y),Z.drawImage(Y,J,t.x-S,t.y-S,f,f,A),Y.translate(t.x,t.y),Y.rotate(-_),Y.translate(-t.x,-t.y)}else Y.fillStyle=K,Y.arc(t.x,t.y,f/2,0,x,!0),Y.fill();if(r){var X=22,m=X+"_"+j+"_"+i,v=G[m];if(v==o){var C=gl("canvas");$.setCanvas(C,X,X);var P=C.getContext("2d"),N=X/2,h=N,W=N;$.translateAndScale(P,0,0,1),P.beginPath();var n=P.createRadialGradient(h,W,0,h,h,N);n.addColorStop(0,j),n.addColorStop(1,i),P.fillStyle=n,P.arc(h,W,N,0,x,!0),P.fill(),v=G[m]=C}var S=d/2;Z.drawImage(Y,v,t.x-S,t.y-S,d,d,A)}},v._80o=function(G){q.call(this,G);var W=this,L=W._data,e=W.gv;L.s(V)&&e.$7e!=o&&Zf.call(W,G)},b._80o=function(r){l.call(this,r);var Y=this,W=Y._data,x=Y.gv;W.s(V)&&x.$7e!=o&&Zf.call(Y,r)}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:this,Object);