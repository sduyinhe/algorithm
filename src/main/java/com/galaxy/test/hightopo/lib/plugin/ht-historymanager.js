!function(H,P){"use strict";var a="ht",X=H[a],$=X.Default,v=$.def,h="add",p="remove",w=$.getInternal(),u="propertyChange";X.HistoryManager=function(K){this._histories=[],this.setDataModel(K)},v(X.HistoryManager,P,{ms_ac:["dataModel","histories","historyIndex","maxHistoryCount"],ms_fire:1,_historyIndex:-1,$4p:0,$8p:0,_maxHistoryCount:10,beginInteraction:function(){var h=this;h.$4p++,1===h.$4p&&(h.$3p=[])},endInteraction:function(){var c=this,t=c._histories,l=c._historyIndex,B=c.$3p;c.$4p>0&&c.$4p--,0===c.$4p&&(delete c.$3p,B&&B.length&&(t=t.slice(0,l+1),t.push(B),t.length>c._maxHistoryCount&&(t=t.slice(t.length-c._maxHistoryCount)),c.setHistories(t),c.setHistoryIndex(t.length-1,!0)))},beginTransient:function(){this.$4p||this.$8p++},endTransient:function(){this.$4p||this.$8p--},setDataModel:function(P){var B=this,Y=B._dataModel;Y!==P&&(Y&&(delete Y._historyManager,Y.umm(B.$5p,B),Y.umd(B.$6p,B)),B._dataModel=P,P._historyManager=B,P.mm(B.$5p,B),P.md(B.$6p,B),B.fp("dataModel",Y,P),B.clear())},setHistoryIndex:function(D,s){var c=this,P=c._historyIndex,M=c._histories.length;if(-1>D?D=-1:D>=M&&(D=M-1),P!==D){if(!s){var e=D-P;e>0?c.$2p(e):0>e&&c.$1p(-e)}c._historyIndex=D,c.fp("historyIndex",P,D)}},setMaxHistoryCount:function(z){var f=this,N=f._histories,K=f._maxHistoryCount;(!z||0>=z)&&(z=10),K!==z&&(f._maxHistoryCount=z,f.fp("maxHistoryCount",K,z),N.length>z&&f.clear())},$5p:function(Z){if(!this.$7p&&!this.$8p){var q,R,x=this,l=x._histories,J=Z.kind,X=Z.property,F=x._historyIndex;if(J===h||J===p?R={type:Z.kind,data:Z.data}:X&&"children"!==X&&"attaches"!==X&&"shape"!==X&&(R={type:u,data:Z.data,property:X,oldValue:Z.oldValue,newValue:Z.newValue}),R)if(x.$4p){q=x.$3p;var P=!1;if(R.type===u)for(var f=q.length-1;f>=0;f--){var G=q[f];if(G.type!==u)break;R.property===G.property&&G.property&&R.data===G.data&&(R.oldValue=G.oldValue,q[f]=R,P=!0)}P||q.push(R)}else q=[R],l=l.slice(0,F+1),l.push(q),l.length>x._maxHistoryCount&&(l=l.slice(l.length-x._maxHistoryCount)),x.setHistories(l),x.setHistoryIndex(l.length-1,!0)}},$6p:function(R){this.$5p(R)},undo:function(W){(!W||0>=W)&&(W=1),this.setHistoryIndex(this._historyIndex-W)},$1p:function(u){var C,U=this,W=U._dataModel,n=U._histories,c=U._historyIndex;for(U.$7p=1,$.setIsolating(!0);u>0;){if(c>=0&&c<n.length){C=n[c],c--;for(var P=C.length-1;P>=0;P--){var b=C[P],D=b.type,B=b.data,Y=b.property,r=b.oldValue;if(D===h)W.remove(B);else if(D===p)W.add(B);else{var t=null;0===Y.indexOf("a:")?(t="attr",Y=Y.replace("a:","")):0===Y.indexOf("s:")&&(t="style",Y=Y.replace("s:","")),w.setPropertyValue(B,t,Y,r)}}}u--}$.setIsolating(!1),delete U.$7p},redo:function(y){(!y||0>=y)&&(y=1),this.setHistoryIndex(this._historyIndex+y)},$2p:function(c){var O,E=this,e=E._dataModel,f=E._histories,P=E._historyIndex;for(E.$7p=1,$.setIsolating(!0);c>0;){if(P>=-1&&P<f.length-1){P++,O=f[P];for(var A=0;A<O.length;A++){var H=O[A],x=H.type,s=H.data,o=H.property,T=H.newValue;if(x===h)e.add(s);else if(x===p)e.remove(s);else{var F=null;0===o.indexOf("a:")?(F="attr",o=o.replace("a:","")):0===o.indexOf("s:")&&(F="style",o=o.replace("s:","")),w.setPropertyValue(s,F,o,T)}}}c--}$.setIsolating(!1),delete E.$7p},clear:function(){this.setHistories([]),this.setHistoryIndex(-1,!0),this.$4p=0,delete this.$3p}})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:this,Object);