!function(C,d){"use strict";var B=ht.AlarmSeverity=function(U,n,H,g,R){this.value=U,this.name=n,this.nickName=H,this.color=g,this.displayName=R};ht.Default.def("ht.AlarmSeverity",d,{toString:function(){return this.displayName||this.name}}),function(){B.severities=new ht.List,B._vm={},B._nm={},B._cp=function(u,r){if(u&&r){var i=u.value-r.value;return i>0?1:0>i?-1:0}return u&&!r?1:!u&&r?-1:0},B.each=function(o,e){B.severities.each(o,e)},B.getSortFunction=function(){return B._cp},B.setSortFunction=function(W){B._cp=W,B.severities.sort(W)},B.add=function(C,D,P,t,U){var Y=new B(C,D,P,t,U);return B._vm[C]=Y,B._nm[D]=Y,B.severities.add(Y),B.severities.sort(B._cp),Y},B.remove=function(b){var P=B._nm[b];return P&&(delete B._nm[b],delete B._vm[P.value],B.severities.remove(P)),P},B.CRITICAL=B.add(500,"Critical","C","#FF0000"),B.MAJOR=B.add(400,"Major","M","#FFA000"),B.MINOR=B.add(300,"Minor","m","#FFFF00"),B.WARNING=B.add(200,"Warning","W","#00FFFF"),B.INDETERMINATE=B.add(100,"Indeterminate","N","#C800FF"),B.CLEARED=B.add(0,"Cleared","R","#00FF00"),B.isClearedAlarmSeverity=function(O){return O?0===O.value:!1},B.getByName=function(M){return B._nm[M]},B.getByValue=function(p){return B._vm[p]},B.clear=function(){B.severities.clear(),B._vm={},B._nm={}},B.compare=function(l,Y){return B._cp(l,Y)}}();var R=ht.AlarmState=function(A){this._d=A,this._nm={},this._am={},this._ps=null,this._haa=null,this._hna=null,this._hoa=null,this._hta=null,this._hls=!1,this._aac=0,this._nac=0};ht.Default.def("ht.AlarmState",d,{_ep:!0,_f:function(){this._c1(),this._c2(),this._c3(),this._c4(),this._c5(),this._c6(),this._c7(),this._d.fp("alarmState",null,this)},getHighestAcknowledgedAlarmSeverity:function(){return this._haa},getHighestNewAlarmSeverity:function(){return this._hna},getHighestOverallAlarmSeverity:function(){return this._hoa},getHighestNativeAlarmSeverity:function(){return this._hta},hasLessSevereNewAlarms:function(){return this._hls},_c1:function(){var i=null;for(var k in this._am)k=B.getByName(k),B.isClearedAlarmSeverity(k)||0!==this.getAcknowledgedAlarmCount(k)&&(i=i?B.compare(i,k)>0?i:k:k);this._haa=i},_c2:function(){var L=null;for(var w in this._nm)w=B.getByName(w),B.isClearedAlarmSeverity(w)||0!==this.getNewAlarmCount(w)&&(L=L?B.compare(L,w)>0?L:w:w);this._hna=L},_c3:function(){if(!this._hna)return this._hls=!1,void 0;for(var O in this._nm)if(O=B.getByName(O),!B.isClearedAlarmSeverity(O)&&0!==this.getNewAlarmCount(O)&&B.compare(this._hna,O)>0)return this._hls=!0,void 0;this._hls=!1},_c4:function(){var k=this._haa,z=this._hna,J=this._ps;this._hoa=k,B.compare(z,this._hoa)>0&&(this._hoa=z),B.compare(J,this._hoa)>0&&(this._hoa=J)},_c5:function(){var d=this._haa,V=this._hna;this._hta=d,B.compare(V,this._hta)>0&&(this._hta=V)},increaseAcknowledgedAlarm:function(N,s){if(0!==s){s=s||1;var $=this._am[N.name]||0;$+=s,this._am[N.name]=$,this._f()}},increaseNewAlarm:function(Q,G){if(0!==G){G=G||1;var y=this._nm[Q.name]||0;y+=G,this._nm[Q.name]=y,this._f()}},decreaseAcknowledgedAlarm:function(o,T){if(0!==T){T||(T=1);var L=this._am[o.name]||0;if(L-=T,0>L)throw"Alarm count can not be negative";this._am[o.name]=L,this._f()}},decreaseNewAlarm:function(L,E){if(0!==E){E||(E=1);var r=this._nm[L.name]||0;if(r-=E,0>r)throw"Alarm count can not be negative";this._nm[L.name]=r,this._f()}},acknowledgeAlarm:function(l){this.decreaseNewAlarm(l,1),this.increaseAcknowledgedAlarm(l,1)},acknowledgeAllAlarms:function(p){if(p){var A=this.getNewAlarmCount(p);this.decreaseNewAlarm(p,A),this.increaseAcknowledgedAlarm(p,A)}else for(var l in this._nm)this.acknowledgeAllAlarms(B.getByName(l))},_c6:function(){this._aac=0;for(var m in this._am)m=B.getByName(m),this._aac+=this.getAcknowledgedAlarmCount(m)},getAcknowledgedAlarmCount:function(V){return V?this._am[V.name]||0:this._aac},getAlarmCount:function(X){return this.getAcknowledgedAlarmCount(X)+this.getNewAlarmCount(X)},_c7:function(){this._nac=0;for(var K in this._nm)this._nac+=this.getNewAlarmCount(B.getByName(K))},getNewAlarmCount:function(o){return o?this._nm[o.name]||0:this._nac},setNewAlarmCount:function(S,a){this._nm[S.name]=a,this._f()},removeAllNewAlarms:function(B){B?delete this._nm[B]:this._nm={},this._f()},setAcknowledgedAlarmCount:function(k,i){this._am[k.name]=i,this._f()},removeAllAcknowledgedAlarms:function(W){W?delete this._am[W.name]:this._am={},this._f()},isEmpty:function(){return!this._hoa},clear:function(){this._am={},this._nm={},this._f()},getPropagateSeverity:function(){return this._ps},setPropagateSeverity:function(z){if(this._ep||(z=null),this._ps!==z){var f=this._ps;this._ps=z,this._f(),this._d.fp("propagateSeverity",f,z)}},isEnablePropagation:function(){return this._ep},setEnablePropagation:function(U){var z=this._ep;this._ep=U,this._d.fp("enablePropagation",z,U)&&(U||this.setPropagateSeverity(null))}});var E=ht.AlarmStatePropagator=function(n){this._dataModel=n,this._enable=!1,this._isPropagating=!1};ht.Default.def("ht.AlarmStatePropagator",d,{getDataModel:function(){return this._dataModel},isEnable:function(){return this._enable},setEnable:function(G){this._enable!==G&&(this._enable=G,this._enable?(this._dataModel.mm(this.handleDataModelChange,this),this._dataModel.md(this.handleDataPropertyChange,this),this._dataModel.each(function(A){this.propagate(A)},this)):(this._dataModel.umm(this.handleDataModelChange,this),this._dataModel.umd(this.handleDataPropertyChange,this)))},handleDataModelChange:function(Y){Y.data&&this.propagate(Y.data)},handleDataPropertyChange:function(K){if("alarmState"===K.property||"enablePropagation"===K.property)this.propagate(K.data);else if("parent"===K.property){var N=K.oldValue;N&&this.propagate(N),this.propagate(K.data)}},propagate:function(R){R&&!this._isPropagating&&(this._isPropagating=!0,this.propagateToTop(R),this._isPropagating=!1)},propagateToTop:function(C){for(this.propagateToParent(null,C);C&&C.getParent();)this.propagateToParent(C,C.getParent()),C=C.getParent()},propagateToParent:function(n,l){var A=null;l.getChildren().each(function(D){var i=D.getAlarmState().getHighestOverallAlarmSeverity();B.compare(i,A)>0&&(A=i)}),l.getAlarmState().setPropagateSeverity(A)}}),ht.AlarmStateStatistics=function(b){this.sumNew=0,this.sumAcked=0,this.sumTotal=0,this.severtiyMap={},this.dataMap={},this.setDataModel(b)},ht.Default.def("ht.AlarmStateStatistics",d,{ms_fire:1,getDataModel:function(){return this._dataModel},setDataModel:function(q){var P=this._dataModel;P!==q&&(P&&(P.umd(this.handleDataPropertyChange,this),P.umm(this.handleDataModelChange,this),this.severtiyMap={},this.dataMap={}),this._dataModel=q,this.reset(),q.md(this.handleDataPropertyChange,this),q.mm(this.handleDataModelChange,this),this.fp("dataModel",P,q))},dispose:function(){this._dataModel.umd(this.handleDataPropertyChange,this),this._dataModel.umm(this.handleDataModelChange,this),delete this._dataModel},handleDataPropertyChange:function(j){"alarmState"===j.property&&(this.increase(j.data),this.fireAlarmStateChange())},handleDataModelChange:function(Q){"add"===Q.kind?(this.increase(Q.data),this.fireAlarmStateChange()):"remove"===Q.kind?(this.decrease(Q.data),this.fireAlarmStateChange()):"clear"===Q.kind&&(this.severtiyMap={},this.dataMap={},this.fireAlarmStateChange())},fireAlarmStateChange:function(){this.sumAcked=0,this.sumNew=0,this.sumTotal=0,B.each(function(V){var t=this.getSumInfo(V);this.sumAcked+=t.ackedCount,this.sumNew+=t.newCount,this.sumTotal+=t.totalCount},this),this.fp("alarmState",!1,!0)},getNewAlarmCount:function(k){if(!k)return this.sumNew;var G=this.getSumInfo(k);return G.newCount},getAcknowledgedAlarmCount:function(g){if(!g)return this.sumAcked;var $=this.getSumInfo(g);return $.ackedCount},getTotalAlarmCount:function(i){if(!i)return this.sumTotal;var T=this.getSumInfo(i);return T.totalCount},getSumInfo:function(q){var C=this.severtiyMap[q.name];return C||(C={},C.newCount=0,C.ackedCount=0,C.totalCount=0,this.severtiyMap[q.name]=C),C},decrease:function(e){var p=this.dataMap[e.getId()];p&&(delete this.dataMap[e.getId()],B.each(function(C){var s=p[C.name],D=this.getSumInfo(C);D.newCount=D.newCount-s.newCount,D.ackedCount=D.ackedCount-s.ackedCount,D.totalCount=D.totalCount-s.totalCount},this))},increase:function(p){if(this.decrease(p),!this._filterFunc||this._filterFunc(p)){var u={},j=p.getAlarmState();this.dataMap[p.getId()]=u,B.each(function(P){var f={};f.newCount=j.getNewAlarmCount(P),f.ackedCount=j.getAcknowledgedAlarmCount(P),f.totalCount=j.getAlarmCount(P),u[P.name]=f;var A=this.getSumInfo(P);A.newCount=A.newCount+f.newCount,A.ackedCount=A.ackedCount+f.ackedCount,A.totalCount=A.totalCount+f.totalCount},this)}},reset:function(){this.severtiyMap={},this.dataMap={},this._dataModel.each(this.increase,this),this.fireAlarmStateChange()},setFilterFunc:function(_){var Q=this._filterFunc;this._filterFunc=_,this.reset(),this.firePropertyChange("filterFunc",Q,_)},getFilterFunc:function(){return this._filterFunc}});var l=ht.Data.prototype;l.getAlarmState=function(){return this._alarmState||(this._alarmState=new R(this))},l=ht.DataModel.prototype,l.isEnableAlarmStatePropagator=function(){return!!this._alarmStatePropagator&&this._alarmStatePropagator.isEnable()},l.setEnableAlarmStatePropagator=function(w){w!=this.isEnableAlarmStatePropagator()&&(w?(this._alarmStatePropagator=new E(this)).setEnable(!0):this._alarmStatePropagator.setEnable(!1))},l=ht.graph.GraphView.prototype,l.getNote2=function(p){var E=p.getAlarmState().getHighestNewAlarmSeverity();if(E){var $=p.getAlarmState().getNewAlarmCount(E)+E.nickName;return p.getAlarmState().hasLessSevereNewAlarms()&&($+="+"),$}return p.s("note2")},l.getNote2Background=function(k){var G=k.getAlarmState().getHighestNewAlarmSeverity();return G?G.color:k.s("note2.background")},l.getBodyColor=function(w){var y=w.getAlarmState().getHighestNativeAlarmSeverity();return y?y.color:w.s("body.color")},l.getBorderColor=function(F){var Z=F.getAlarmState().getPropagateSeverity();return Z?Z.color:F.s("border.color")},l=ht.widget.TreeView.prototype,l.getBorderColor=function(E){var h=E.getAlarmState().getPropagateSeverity();return h?h.color:E.s("border.color")},l.getIcon=function(v){return v.getIcon()?"__alarmIcon__":null},l=ht.widget.TreeTableView.prototype,l.getBorderColor=function(l){var J=l.getAlarmState().getPropagateSeverity();return J?J.color:l.s("border.color")},l.getIcon=function(M){return M.getIcon()?"__alarmIcon__":null},ht.Default.setImage("__alarmIcon__",{width:16,height:16,comps:[{type:"image",name:{func:function(I){return I.getIcon()}},color:{func:function(N){var H=N.getAlarmState().getHighestNativeAlarmSeverity();return H?H.color:N.s("body.color")}},rect:[0,0,16,16]}]});var i=ht.Style;i["note2.expanded"]=!0,i["note2.color"]="#000"}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:this,Object);